@model TechCertain.WebUI.Models.Programme.ProgrammeInfoViewModel

<script src="https://www.jqueryscript.net/demo/Bootstrap-Dropdown-Replacement-Plugin-DDL/js/bootstrap-ddl.js"></script>

@{
    string EGlobalIsActiveOrNot = "";
    if (Model.EGlobalIsActiveOrNot)
    {
        EGlobalIsActiveOrNot = @"EGlobal site is active";
    }
    else
    {
        EGlobalIsActiveOrNot = @"EGlobal site is inactive";
    }

}

<!-- MAIN CONTENT -->
<div id="content">
    <!-- Bread crumb is created dynamically -->
    <!-- row -->
    <div class="row">
        <!-- col -->
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <h1 class="page-title txt-color-blueDark">
                <!-- PAGE HEADER -->
                <i class="fa-fw fa fa-home"></i>
                <a href="~/Agreement/ViewAcceptedAgreement/@Model.clientprogramme.Id"> Agreement</a>
                > <span>
                    Edit Billing Configuration
                </span>
            </h1>
        </div>
        <!-- end col -->
    </div>
    <span>
        <a onclick="location.href='@Url.Action("ViewAcceptedAgreement", "Agreement",new { Id =@Model.clientprogramme.Id })'" style="color:dodgerblue;font-size:30px; cursor:pointer"> <span _ngcontent-c7="" class="icon-append fa fa-arrow-circle-left"></span>  </a>
    </span>

    @Html.HiddenFor(m => m.Id)

    <!-- widget grid -->
    <section id="widget-grid" class="">

        <div class="row">
            <article class="col-sm-12 col-md-12 col-lg-12">
                <!-- new widget -->
                <div class="jarviswidget jarviswidget-color-blue" id="wid-id-2" data-widget-editbutton="true" data-widget-colorbutton="false">
                    <header>
                        <span class="widget-icon"> <i class="fa fa--envelope txt-color-white"></i> </span>
                        <h2> </h2>
                    </header>
                    @*<div class="row">*@

                    <section>
                        <table class="table table-bordered table-striped table-hover table-condensed">
                            <tbody>
                                <tr>

                                    <td align="left">
                                        <b>eGlobal Status: </b>
                                    </td>

                                    <td align="left">
                                        @EGlobalIsActiveOrNot
                                    </td>

                                </tr>
                                <tr>

                                    <td align="left">
                                        <b>eGlobal Client Branch:</b>
                                    </td>

                                    <td align="left">
                                        <select class="browser-default custom-select custom-select-sm mb-3 col-sm-3" id="branch">
                                            <option selected="selected" value="">-- Select here --</option>
                                            <option value="AKL">AKL</option>
                                            <option value="CHC">CHC</option>
                                            <option value="DUN">DUN</option>
                                            <option value="NAP">NAP</option>
                                            <option value="NPL">NPL</option>
                                            <option value="TGA">TGA</option>
                                            <option value="WEL">WEL</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>

                                    <td align="left">
                                        <b>eGlobal Client Number:</b>
                                    </td>

                                    <td align="left">
                                        <div style="text-align:left" class="col-sm-3">
                                            <input id="clientId" class="form-control" type="text">
                                        </div>
                                    </td>
                                </tr>
                                <tr>

                                    <td align="left">
                                        <b>Broker Salesperson User:</b>
                                    </td>

                                    <td align="left">
                                        @Model.BrokerContactUser.FullName (@Model.BrokerContactUser.SalesPersonUserName)
                                    </td>

                                </tr>
                                <tr>

                                    <td align="left">
                                        <b>Broker Branch:</b>
                                    </td>

                                    <td align="left">
                                        @Model.BrokerContactUser.DefaultOU.Name (@Model.BrokerContactUser.DefaultOU.EbixDepartmentCode)
                                    </td>

                                </tr>
                                @*<tr>

                                        <td align="left">
                                            <b>Client Status</b>
                                        </td>

                                        <td style="align-content: center">
                                            <div class="form-group drop-down-list">
                                                <div class="col-sm-5" style="text-align: center">
                                                    <select class="browser-default custom-select custom-select-lg mb-3 col-sm-5" id="clientStatus">
                                                        <option selected="selected" value="">-- Select here --</option>
                                                        <option value="New">New</option>
                                                        <option value="Renew">Renew</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>

                                        <td align="left">
                                            <b>Transaction Description</b>
                                        </td>

                                        <td align="left">
                                            <div class="custom-control custom-radio">
                                                <select class="browser-default custom-select custom-select-lg mb-3 col-sm-5" id="TransactionRadio">
                                                    <option selected="selected" value="">-- Select here --</option>
                                                    <option value="True">Yes</option>
                                                    <option value="False">No</option>
                                                </select>

                                                <label class="custom-control-label" for="defaultUnchecked">Use custom transaction description</label>
                                            </div>
                                            <div class="form-group">
                                                <textarea class="form-control" placeholder="Custom description" rows="5" id="TransactionComment"></textarea>
                                            </div>
                                        </td>

                                    </tr>*@
                                <tr>
                                    <td align="left" colspan="2">
                                        <button onclick="ClearForm()" class="btn txt-color-white bg-color-green btn-sm" id="ClearForm"><i class="fa fa-edit"></i>Clear</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                        <button onclick="SaveBillingConfiguration()" class="btn txt-color-white bg-color-yellow btn-sm" id="SaveBillingConfiguration"><i class="fa fa-trash"></i>Save</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                        <button onclick="SendInvoice()" class="btn txt-color-white bg-color-green btn-sm" id="SendInvoice"><i class="fa fa-edit"></i>Send Invoice</button>
                                    </td>

                                </tr>
                            </tbody>
                        </table>

                    </section>
                </div>
            </article>

            @*<div class="form-group row col-xs-12">
                    <div class="left col-xs-2">
                        <button onclick="ClearForm()" class="btn-sm float-left" id="ClearForm">Clear</button>
                        <button onclick="SaveBillingConfiguration()" class="btn-sm float-right" id="SaveBillingConfiguration">Save</button>
                    </div>
                    <div class="col-sm-offset-5">
                        <button onclick="SendInvoice()" class="btn-sm" id="SendInvoice">Send Invoice</button>
                    </div>
                </div>*@
        </div>
    </section>
</div>

@if (Model.EGlobalSubmissions.Count > 0)
{
<div role="content">
    <form method="POST" id="update-form" class="client-form" enctype="multipart/form-data">
        <header>  Invoice Management</header>
        <table class="table table-bordered table-responsive-md table-striped text-center" id="eglobaltransactions">
            <tr>
                <th class="text-center" width="60%" style="color:black">Transaction Description</th>
                <th class="text-center" width="20%" style="color:black">Transaction Details</th>
                <th class="text-center" width="20%" style="color:black"></th>
            </tr>

            @foreach (var item in Model.EGlobalSubmissions)
            {
            <tr>
            <td class="pt-3-half" width="40%" contenteditable="true" id="ReferralName" style="color:black">
                @item.DateCreated
            </td>
            <td class="pt-3-half" width="20%" contenteditable="true" style="color:black">
                @item.SubmissionRequestXML
            </td>
            <td width="20%">
                @*<a href="#myModal" aria-hidden="true" style="color:green" data-toggle="modal" data-rule-id="@item.Id" data-rule-name="@item.Name"
            data-rule-desc="@item.Description" data-rule-val="@item.Value" data-rule-order="@item.OrderNumber"><i class="fa fa-edit"> </i></a>*@
            </td>
            </tr>
            }
        </table>
    </form>

</div>
}



@section pagespecific {
    <script>

        $(window).on("load", function () {
            debugger;
            $('#branch').val(@Model.EGlobalBranchCode);
            @*$('#clientStatus').val(@Model.EGlobalClientStatus);*@
            $('#clientId').val(@Model.EGlobalClientNumber);
            @*$('#TransactionRadio').val(@Model.HasEGlobalCustomDescription);
            $('TransactionComment').val(@Model.EGlobalCustomDescription);*@
        });

        var bcdata = [];
        var programmeId;

        function SendInvoice() {
            //SaveBillingInformation();
            programmeId = $('#Id').val();

            $.ajax({
            type: "POST",
            url: "@Url.Action("SendInvoice", "Programme")",
            data: { programmeId : programmeId },
            traditional: true,
            })
                .done(function (data) {
                    //$.smallBox({
                    //    title: "Invoice has been sent",
                    //    color: "#5F895F",
                    //    iconSmall: "fa fa-check bounce animated",
                    //    timeout: 4000
                    //});
                    window.location.href = data.url;
                })
                .fail(function (jqXHR, textStatus, errorThrown) {
                    alert("There was an error while trying to send your invoice.");
                });
        }

        function SaveBillingConfiguration() {
            addBCData();
            debugger;
            $.ajax({
            type: "POST",
            url: "@Url.Action("SaveBillingConfiguration", "Programme")",
            data: { billingConfig : bcdata, programmeId : programmeId },
            traditional: true,
            })
                .done(function (data) {
                    //$.smallBox({
                    //    title: "billing configuration has been saved",
                    //    color: "#5F895F",
                    //    iconSmall: "fa fa-check bounce animated",
                    //    timeout: 4000
                    //});
                    alert("Saved.");
                })
                .fail(function (jqXHR, textStatus, errorThrown) {
                    alert("You are going to save billing configuration.");
                });
        }

        function ClearForm() {
            document.getElementById("branch").value = "";
            document.getElementById("clientId").value = "";
            //document.getElementById("TransactionComment").value = "";
            //document.getElementById("clientStatus").value = "";
        }

        function addBCData() {
            programmeId = $('#Id').val();
            var branch = document.getElementById("branch").value;
            var clientId = document.getElementById("clientId").value;
            //var clientStatus = document.getElementById("clientStatus").value;
            //var TransactionComment = document.getElementById("TransactionComment").value;
            //var TransactionRadio = document.getElementById("TransactionRadio").value;
            //bcdata = [branch, clientId, clientStatus, TransactionComment,TransactionRadio];
            bcdata = [branch, clientId];
        }

    </script>

}


<script>

        $(window).on("load", function () {
            debugger;
            $('#branch').val("@Model.EGlobalBranchCode");
            @*$('#clientStatus').val("@Model.EGlobalClientStatus");*@
            $('#clientId').val("@Model.EGlobalClientNumber");
            @*$('#TransactionRadio').val("@Model.HasEGlobalCustomDescription");
            $('TransactionComment').val("@Model.EGlobalCustomDescription");*@

        });

</script>
