@model TechCertain.WebUI.Models.Programme.ProgrammeInfoViewModel

@{
    string EGlobalIsActiveOrNot = "";
    if (Model.EGlobalIsActiveOrNot)
    {
        EGlobalIsActiveOrNot = @"EGlobal site is active";
    }
    else
    {
        EGlobalIsActiveOrNot = @"EGlobal site is inactive";
    }

}

<!-- MAIN CONTENT -->
<div id="content" class="container">

    <div class="row">
        <h1 class="page-title txt-color-blueDark">
            <i class="fa-fw fa fa-home"></i>
            <a href="~/Agreement/ViewAcceptedAgreement/@Model.clientprogramme.Id"> Agreement</a>
            > <span>
                Edit Billing Configuration
            </span>
        </h1>
    </div>
    <!-- end col -->
    <div class="row">
        <span>
            <a onclick="location.href='@Url.Action("ViewAcceptedAgreement", "Agreement",new { Id =@Model.clientprogramme.Id })'" style="color:dodgerblue;font-size:30px; cursor:pointer"> <span _ngcontent-c7="" class="icon-append fa fa-arrow-circle-left"></span>  </a>
        </span>
    </div>

    @Html.HiddenFor(m => m.Id)

    <div class="row">
        <!-- new widget -->
        <div class="jarviswidget jarviswidget-color-blue container-fluid" id="wid-id-2" data-widget-editbutton="true" data-widget-colorbutton="false">
            <header>
                <span class="widget-icon"> <i class="fa fa-envelope text-light"></i> </span>
                <h2>Billing Configuration</h2>
            </header>

            <table class="table table-bordered table-striped table-hover table-condensed">
                <tbody>
                    <tr>

                        <td align="left">
                            <b>eGlobal Status: </b>
                        </td>

                        <td align="left">
                            @EGlobalIsActiveOrNot
                        </td>

                    </tr>
                    <tr>

                        <td align="left">
                            <b>eGlobal Client Branch:</b>
                        </td>

                        <td align="left">
                            <select class="browser-default custom-select custom-select-sm col-sm-3" id="branch">
                                <option selected="selected" value="">-- Select here --</option>
                                <option value="AKL">AKL</option>
                                <option value="CHC">CHC</option>
                                <option value="DUN">DUN</option>
                                <option value="NAP">NAP</option>
                                <option value="NPL">NPL</option>
                                <option value="TGA">TGA</option>
                                <option value="WEL">WEL</option>
                            </select>
                        </td>
                    </tr>
                    <tr>

                        <td align="left">
                            <b>eGlobal Client Number:</b>
                        </td>

                        <td align="left">
                            <input id="clientId" class="form-control col-3" type="text">
                        </td>
                    </tr>
                    <tr>

                        <td align="left">
                            <b>Broker Salesperson User:</b>
                        </td>

                        <td align="left">
                            @Model.BrokerContactUser.FullName (@Model.BrokerContactUser.SalesPersonUserName)
                        </td>

                    </tr>
                    <tr>

                        <td align="left">
                            <b>Broker Branch:</b>
                        </td>

                        <td align="left">
                            @Model.BrokerContactUser.DefaultOU.Name (@Model.BrokerContactUser.DefaultOU.EbixDepartmentCode)
                        </td>

                    </tr>
                    <tr>
                        <td align="left" colspan="2">
                            <button onclick="SaveBillingConfiguration()" class="btn btn-success btn-sm" id="SaveBillingConfiguration"><i class="fa fa-edit"></i>Save</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            <button onclick="ClearForm()" class="btn btn-danger btn-sm" id="ClearForm"><i class="fa fa-trash"></i>Clear</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            <button onclick="SendInvoice()" class="btn btn-success btn-sm" id="SendInvoice"><i class="fa fa-edit"></i>Send Invoice</button>
                        </td>

                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

@*@if (Model.EGlobalSubmissions.Count > 0)
{
    <div id="content">
        <form method="POST" id="update-form" class="client-form" enctype="multipart/form-data">
            <header>  Invoice Management</header>
            <table class="table table-bordered table-responsive-md table-striped text-center" id="eglobaltransactions">
                <tr>
                    <th class="text-center" width="60%" style="color:black">Transaction Description</th>
                    <th class="text-center" width="20%" style="color:black">Transaction Details</th>
                    <th class="text-center" width="20%" style="color:black"></th>
                </tr>

                @foreach (var item in Model.EGlobalSubmissions)
                {
                    <tr>
                        <td class="pt-3-half" width="40%" contenteditable="true" id="ReferralName" style="color:black">
                            @item.DateCreated
                        </td>
                        <td class="pt-3-half" width="20%" contenteditable="true" style="color:black">
                            @item.SubmissionRequestXML
                        </td>
                        <td width="20%">
                            
                        </td>
                    </tr>
                }
            </table>
        </form>

    </div>
}*@



@section pagespecific {
    <script>

        $(window).on("load", function () {
            $('#clientId').val(@Model.EGlobalClientNumber);
            $('#branch').val("@Model.EGlobalBranchCode");
        });

        var bcdata = [];
        var programmeId;

        function SendInvoice() {
            programmeId = $('#Id').val();

            $.ajax({
            type: "POST",
            url: "@Url.Action("SendInvoice", "Programme")",
            data: { programmeId : programmeId },
            traditional: true,
            })
                .done(function (data) {
                    //$.smallBox({
                    //    title: "Invoice has been sent",
                    //    color: "#5F895F",
                    //    iconSmall: "fa fa-check bounce animated",
                    //    timeout: 4000
                    //});
                    window.location.href = data.url;
                })
                .fail(function (jqXHR, textStatus, errorThrown) {
                    alert("There was an error while trying to send your invoice.");
                });
        }

        function SaveBillingConfiguration() {
            addBCData();
            debugger;
            $.ajax({
            type: "POST",
            url: "@Url.Action("SaveBillingConfiguration", "Programme")",
            data: { billingConfig : bcdata, programmeId : programmeId },
            traditional: true,
            })
                .done(function (data) {
                    //$.smallBox({
                    //    title: "billing configuration has been saved",
                    //    color: "#5F895F",
                    //    iconSmall: "fa fa-check bounce animated",
                    //    timeout: 4000
                    //});
                    alert("Saved.");
                })
                .fail(function (jqXHR, textStatus, errorThrown) {
                    alert("You are going to save billing configuration.");
                });
        }

        function ClearForm() {
            document.getElementById("branch").value = "";
            document.getElementById("clientId").value = "";
        }

        function addBCData() {
            programmeId = $('#Id').val();
            var branch = document.getElementById("branch").value;
            var clientId = document.getElementById("clientId").value;
            bcdata = [branch, clientId];
        }

    </script>

}

