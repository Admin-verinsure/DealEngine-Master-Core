!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base"],e):e(jQuery)}(function(g){"use strict";g.fmatter={},g.extend(g.fmatter,{isBoolean:function(e){return"boolean"==typeof e},isObject:function(e){return e&&("object"==typeof e||g.isFunction(e))||!1},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e&&isFinite(e)},isValue:function(e){return this.isObject(e)||this.isString(e)||this.isNumber(e)||this.isBoolean(e)},isEmpty:function(e){return!(!this.isString(e)&&this.isValue(e))&&(!this.isValue(e)||""===(e=g.trim(e).replace(/\&nbsp\;/gi,"").replace(/\&#160\;/gi,"")))}}),g.fn.fmatter=function(e,t,i,r,o){var n=t;i=g.extend({},g.jgrid.getRegional(this,"formatter"),i);try{n=g.fn.fmatter[e].call(this,t,i,r,o)}catch(e){}return n},g.fmatter.util={NumberFormat:function(e,t){if(g.fmatter.isNumber(e)||(e*=1),g.fmatter.isNumber(e)){var i=e<0,r=String(e),o=t.decimalSeparator||".";if(g.fmatter.isNumber(t.decimalPlaces)){var n=t.decimalPlaces,a=(r=String(Number(Math.round(e+"e"+n)+"e-"+n))).lastIndexOf(".");if(0<n)for(a<0?a=(r+=o).length-1:"."!==o&&(r=r.replace(".",o));r.length-1-a<n;)r+="0"}if(t.thousandsSeparator){var l=t.thousandsSeparator;a=-1<(a=r.lastIndexOf(o))?a:r.length;for(var d=r.substring(a),s=-1,f=a;0<f;f--)++s%3==0&&f!==a&&(!i||1<f)&&(d=l+d),d=r.charAt(f-1)+d;r=d}return r=t.prefix?t.prefix+r:r,r=t.suffix?r+t.suffix:r}return e}},g.fn.fmatter.defaultFormat=function(e,t){return g.fmatter.isValue(e)&&""!==e?e:t.defaultValue||"&#160;"},g.fn.fmatter.email=function(e,t){return g.fmatter.isEmpty(e)?g.fn.fmatter.defaultFormat(e,t):'<a href="mailto:'+e+'">'+e+"</a>"},g.fn.fmatter.checkbox=function(e,t){var i,r=g.extend({},t.checkbox);return void 0!==t.colModel&&void 0!==t.colModel.formatoptions&&(r=g.extend({},r,t.colModel.formatoptions)),i=!0===r.disabled?'disabled="disabled"':"",!g.fmatter.isEmpty(e)&&void 0!==e||(e=g.fn.fmatter.defaultFormat(e,r)),'<input type="checkbox" '+((e=((e=String(e))+"").toLowerCase()).search(/(false|f|0|no|n|off|undefined)/i)<0?" checked='checked' ":"")+' value="'+e+'" offval="no" '+i+"/>"},g.fn.fmatter.link=function(e,t){var i={target:t.target},r="";return void 0!==t.colModel&&void 0!==t.colModel.formatoptions&&(i=g.extend({},i,t.colModel.formatoptions)),i.target&&(r="target="+i.target),g.fmatter.isEmpty(e)?g.fn.fmatter.defaultFormat(e,t):"<a "+r+' href="'+e+'">'+e+"</a>"},g.fn.fmatter.showlink=function(e,t){var i,r={baseLinkUrl:t.baseLinkUrl,showAction:t.showAction,addParam:t.addParam||"",target:t.target,idName:t.idName},o="";return void 0!==t.colModel&&void 0!==t.colModel.formatoptions&&(r=g.extend({},r,t.colModel.formatoptions)),r.target&&(o="target="+r.target),i=r.baseLinkUrl+r.showAction+"?"+r.idName+"="+t.rowId+r.addParam,g.fmatter.isString(e)||g.fmatter.isNumber(e)?"<a "+o+' href="'+i+'">'+e+"</a>":g.fn.fmatter.defaultFormat(e,t)},g.fn.fmatter.integer=function(e,t){var i=g.extend({},t.integer);return void 0!==t.colModel&&void 0!==t.colModel.formatoptions&&(i=g.extend({},i,t.colModel.formatoptions)),g.fmatter.isEmpty(e)?i.defaultValue:g.fmatter.util.NumberFormat(e,i)},g.fn.fmatter.number=function(e,t){var i=g.extend({},t.number);return void 0!==t.colModel&&void 0!==t.colModel.formatoptions&&(i=g.extend({},i,t.colModel.formatoptions)),g.fmatter.isEmpty(e)?i.defaultValue:g.fmatter.util.NumberFormat(e,i)},g.fn.fmatter.currency=function(e,t){var i=g.extend({},t.currency);return void 0!==t.colModel&&void 0!==t.colModel.formatoptions&&(i=g.extend({},i,t.colModel.formatoptions)),g.fmatter.isEmpty(e)?i.defaultValue:g.fmatter.util.NumberFormat(e,i)},g.fn.fmatter.date=function(e,t,i,r){var o=g.extend({},t.date);return void 0!==t.colModel&&void 0!==t.colModel.formatoptions&&(o=g.extend({},o,t.colModel.formatoptions)),!o.reformatAfterEdit&&"edit"===r||g.fmatter.isEmpty(e)?g.fn.fmatter.defaultFormat(e,t):g.jgrid.parseDate.call(this,o.srcformat,e,o.newformat,o)},g.fn.fmatter.select=function(e,t){e=String(e);var i,r,o=!1,n=[];if(void 0!==t.colModel.formatoptions?(o=t.colModel.formatoptions.value,i=void 0===t.colModel.formatoptions.separator?":":t.colModel.formatoptions.separator,r=void 0===t.colModel.formatoptions.delimiter?";":t.colModel.formatoptions.delimiter):void 0!==t.colModel.editoptions&&(o=t.colModel.editoptions.value,i=void 0===t.colModel.editoptions.separator?":":t.colModel.editoptions.separator,r=void 0===t.colModel.editoptions.delimiter?";":t.colModel.editoptions.delimiter),o){var a,l=!0==(null!=t.colModel.editoptions&&!0===t.colModel.editoptions.multiple),d=[];if(l&&(d=e.split(","),d=g.map(d,function(e){return g.trim(e)})),g.fmatter.isString(o)){for(var s=o.split(r),f=0,c=0;c<s.length;c++)if(2<(a=s[c].split(i)).length&&(a[1]=g.map(a,function(e,t){if(0<t)return e}).join(i)),l)-1<g.inArray(a[0],d)&&(n[f]=a[1],f++);else if(g.trim(a[0])===g.trim(e)){n[0]=a[1];break}}else g.fmatter.isObject(o)&&(l?n=g.map(d,function(e){return o[e]}):n[0]=o[e]||"")}return""===(e=n.join(", "))?g.fn.fmatter.defaultFormat(e,t):e},g.fn.fmatter.rowactions=function(e){function t(e){g.isFunction(c.afterRestore)&&c.afterRestore.call(l,e),f.find("div.ui-inline-edit,div.ui-inline-del").show(),f.find("div.ui-inline-save,div.ui-inline-cancel").hide()}var i,r=g(this).closest("tr.jqgrow"),o=r.attr("id"),n=g(this).closest("table.ui-jqgrid-btable").attr("id").replace(/_frozen([^_]*)$/,"$1"),a=g("#"+n),l=a[0],d=l.p,s=d.colModel[g.jgrid.getCellIndex(this)],f=s.frozen?g("tr#"+o+" td:eq("+g.jgrid.getCellIndex(this)+") > div",a):g(this).parent(),c={extraparam:{}};void 0!==s.formatoptions&&(i=g.extend(!0,{},s.formatoptions),c=g.extend(c,i)),void 0!==d.editOptions&&(c.editOptions=d.editOptions),void 0!==d.delOptions&&(c.delOptions=d.delOptions),r.hasClass("jqgrid-new-row")&&(c.extraparam[d.prmNames.oper]=d.prmNames.addoper);var u={keys:c.keys,oneditfunc:c.onEdit,successfunc:c.onSuccess,url:c.url,extraparam:c.extraparam,aftersavefunc:function(e,t){g.isFunction(c.afterSave)&&c.afterSave.call(l,e,t),f.find("div.ui-inline-edit,div.ui-inline-del").show(),f.find("div.ui-inline-save,div.ui-inline-cancel").hide()},errorfunc:c.onError,afterrestorefunc:t,restoreAfterError:c.restoreAfterError,mtype:c.mtype};switch(e){case"edit":a.jqGrid("editRow",o,u),f.find("div.ui-inline-edit,div.ui-inline-del").hide(),f.find("div.ui-inline-save,div.ui-inline-cancel").show(),a.triggerHandler("jqGridAfterGridComplete");break;case"save":a.jqGrid("saveRow",o,u)&&(f.find("div.ui-inline-edit,div.ui-inline-del").show(),f.find("div.ui-inline-save,div.ui-inline-cancel").hide(),a.triggerHandler("jqGridAfterGridComplete"));break;case"cancel":a.jqGrid("restoreRow",o,t),f.find("div.ui-inline-edit,div.ui-inline-del").show(),f.find("div.ui-inline-save,div.ui-inline-cancel").hide(),a.triggerHandler("jqGridAfterGridComplete");break;case"del":a.jqGrid("delGridRow",o,c.delOptions);break;case"formedit":a.jqGrid("setSelection",o),a.jqGrid("editGridRow",o,c.editOptions)}},g.fn.fmatter.actions=function(e,t){var i,r={keys:!1,editbutton:!0,delbutton:!0,editformbutton:!1},o=t.rowId,n="",a=g.jgrid.getRegional(this,"nav"),l=g.jgrid.styleUI[t.styleUI||"jQueryUI"].fmatter,d=g.jgrid.styleUI[t.styleUI||"jQueryUI"].common;if(void 0!==t.colModel.formatoptions&&(r=g.extend(r,t.colModel.formatoptions)),void 0===o||g.fmatter.isEmpty(o))return"";var s="onmouseover=jQuery(this).addClass('"+d.hover+"'); onmouseout=jQuery(this).removeClass('"+d.hover+"');  ";return r.editformbutton?(i="id='jEditButton_"+o+"' onclick=jQuery.fn.fmatter.rowactions.call(this,'formedit'); "+s,n+="<div title='"+a.edittitle+"' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit' "+i+"><span class='"+d.icon_base+" "+l.icon_edit+"'></span></div>"):r.editbutton&&(i="id='jEditButton_"+o+"' onclick=jQuery.fn.fmatter.rowactions.call(this,'edit'); "+s,n+="<div title='"+a.edittitle+"' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit' "+i+"><span class='"+d.icon_base+" "+l.icon_edit+"'></span></div>"),r.delbutton&&(i="id='jDeleteButton_"+o+"' onclick=jQuery.fn.fmatter.rowactions.call(this,'del'); "+s,n+="<div title='"+a.deltitle+"' style='float:left;' class='ui-pg-div ui-inline-del' "+i+"><span class='"+d.icon_base+" "+l.icon_del+"'></span></div>"),i="id='jSaveButton_"+o+"' onclick=jQuery.fn.fmatter.rowactions.call(this,'save'); "+s,n+="<div title='"+a.savetitle+"' style='float:left;display:none' class='ui-pg-div ui-inline-save' "+i+"><span class='"+d.icon_base+" "+l.icon_save+"'></span></div>",i="id='jCancelButton_"+o+"' onclick=jQuery.fn.fmatter.rowactions.call(this,'cancel'); "+s,"<div style='margin-left:8px;'>"+(n+="<div title='"+a.canceltitle+"' style='float:left;display:none;' class='ui-pg-div ui-inline-cancel' "+i+"><span class='"+d.icon_base+" "+l.icon_cancel+"'></span></div>")+"</div>"},g.unformat=function(e,t,i,r){var o,n=t.colModel.formatter,a=t.colModel.formatoptions||{},l=/([\.\*\_\'\(\)\{\}\+\?\\])/g,d=t.colModel.unformat||g.fn.fmatter[n]&&g.fn.fmatter[n].unformat;if(void 0!==d&&g.isFunction(d))u=d.call(this,g(e).text(),t,e);else if(void 0!==n&&g.fmatter.isString(n)){var s,f=g.jgrid.getRegional(this,"formatter")||{};switch(n){case"integer":o=(a=g.extend({},f.integer,a)).thousandsSeparator.replace(l,"\\$1"),s=new RegExp(o,"g"),u=g(e).text().replace(s,"");break;case"number":o=(a=g.extend({},f.number,a)).thousandsSeparator.replace(l,"\\$1"),s=new RegExp(o,"g"),u=g(e).text().replace(s,"").replace(a.decimalSeparator,".");break;case"currency":o=(a=g.extend({},f.currency,a)).thousandsSeparator.replace(l,"\\$1"),s=new RegExp(o,"g"),u=g(e).text(),a.prefix&&a.prefix.length&&(u=u.substr(a.prefix.length)),a.suffix&&a.suffix.length&&(u=u.substr(0,u.length-a.suffix.length)),u=u.replace(s,"").replace(a.decimalSeparator,".");break;case"checkbox":var c=t.colModel.editoptions?t.colModel.editoptions.value.split(":"):["Yes","No"],u=g("input",e).is(":checked")?c[0]:c[1];break;case"select":u=g.unformat.select(e,t,i,r);break;case"actions":return"";default:u=g(e).text()}}return void 0!==u?u:!0===r?g(e).text():g.jgrid.htmlDecode(g(e).html())},g.unformat.select=function(e,t,i,r){var o=[],n=g(e).text();if(!0===r)return n;var a=g.extend({},void 0!==t.colModel.formatoptions?t.colModel.formatoptions:t.colModel.editoptions),l=void 0===a.separator?":":a.separator,d=void 0===a.delimiter?";":a.delimiter;if(a.value){var s,f=a.value,c=!0===a.multiple,u=[];if(c&&(u=n.split(","),u=g.map(u,function(e){return g.trim(e)})),g.fmatter.isString(f)){for(var m=f.split(d),p=0,v=0;v<m.length;v++)if(2<(s=m[v].split(l)).length&&(s[1]=g.map(s,function(e,t){if(0<t)return e}).join(l)),a.decodeValue&&!0===a.decodeValue&&(s[1]=g.jgrid.htmlDecode(s[1])),c)-1<g.inArray(g.trim(s[1]),u)&&(o[p]=s[0],p++);else if(g.trim(s[1])===g.trim(n)){o[0]=s[0];break}}else(g.fmatter.isObject(f)||g.isArray(f))&&(c||(u[0]=n),o=g.map(u,function(i){var r;if(g.each(f,function(e,t){if(t===i)return r=e,!1}),void 0!==r)return r}));return o.join(", ")}return n||""},g.unformat.date=function(e,t){var i=g.jgrid.getRegional(this,"formatter.date")||{};return void 0!==t.formatoptions&&(i=g.extend({},i,t.formatoptions)),g.fmatter.isEmpty(e)?g.fn.fmatter.defaultFormat(e,t):g.jgrid.parseDate.call(this,i.newformat,e,i.srcformat,i)}});