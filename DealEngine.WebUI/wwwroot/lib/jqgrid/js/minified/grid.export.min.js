!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base","./jquery.fmatter","./grid.utils"],e):e(jQuery)}(function(R){"use strict";R.jgrid=R.jgrid||{},R.extend(R.jgrid,{formatCell:function(e,t,r,l,o,a){var n;return void 0!==l.formatter?(n={rowId:"",colModel:l,gid:o.p.id,pos:t,styleUI:"",isExported:!0,exporttype:a},R.isFunction(l.formatter)?l.formatter.call(o,e,n,r):R.fmatter?R.fn.fmatter.call(o,l.formatter,e,n,r):e):e},formatCellCsv:function(t,e){t=null==t?"":String(t);try{t=R.jgrid.stripHtml(t.replace(e._regexsep,e.separatorReplace).replace(/\r\n/g,e.replaceNewLine).replace(/\n/g,e.replaceNewLine))}catch(e){t=""}return e.escquote&&(t=t.replace(e._regexquot,e.escquote+e.quote)),-1!==t.indexOf(e.separator)&&-1!==t.indexOf(e.qoute)||(t=e.quote+t+e.quote),t},excelCellPos:function(e){for(var t="A".charCodeAt(0),r="Z".charCodeAt(0)-t+1,l="";0<=e;)l=String.fromCharCode(e%r+t)+l,e=Math.floor(e/r)-1;return l},makeNode:function(e,t,r){var l=e.createElement(t);return r&&(r.attr&&R(l).attr(r.attr),r.children&&R.each(r.children,function(e,t){l.appendChild(t)}),r.hasOwnProperty("text")&&l.appendChild(e.createTextNode(r.text))),l},xmlToZip:function(o,e){var a,n,d,i,p,s,m=this,f=new XMLSerializer,u=-1===f.serializeToString(R.parseXML(R.jgrid.excelStrings["xl/worksheets/sheet1.xml"])).indexOf("xmlns:r"),c=[];R.each(e,function(e,t){if(R.isPlainObject(t))a=o.folder(e),m.xmlToZip(a,t);else{if(u){for(n=t.childNodes[0],d=n.attributes.length-1;0<=d;d--){var r=n.attributes[d].nodeName,l=n.attributes[d].nodeValue;-1!==r.indexOf(":")&&(c.push({name:r,value:l}),n.removeAttribute(r))}for(d=0,i=c.length;d<i;d++)(p=t.createAttribute(c[d].name.replace(":","_dt_b_namespace_token_"))).value=c[d].value,n.setAttributeNode(p)}s=f.serializeToString(t),u&&(-1===s.indexOf("<?xml")&&(s='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>'+s),s=s.replace(/_dt_b_namespace_token_/g,":")),s=s.replace(/<row xmlns="" /g,"<row ").replace(/<cols xmlns="">/g,"<cols>").replace(/<mergeCells xmlns="" /g,"<mergeCells ").replace(/<numFmt xmlns="" /g,"<numFmt ").replace(/<xf xmlns="" /g,"<xf "),o.file(e,s)}})},excelStrings:{"_rels/.rels":'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships"><Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="xl/workbook.xml"/></Relationships>',"xl/_rels/workbook.xml.rels":'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships"><Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet" Target="worksheets/sheet1.xml"/><Relationship Id="rId2" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles" Target="styles.xml"/></Relationships>',"[Content_Types].xml":'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types"><Default Extension="xml" ContentType="application/xml" /><Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml" /><Default Extension="jpeg" ContentType="image/jpeg" /><Override PartName="/xl/workbook.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml" /><Override PartName="/xl/worksheets/sheet1.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml" /><Override PartName="/xl/styles.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml" /></Types>',"xl/workbook.xml":'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><workbook xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships"><fileVersion appName="xl" lastEdited="5" lowestEdited="5" rupBuild="24816"/><workbookPr showInkAnnotation="0" autoCompressPictures="0"/><bookViews><workbookView xWindow="0" yWindow="0" windowWidth="25600" windowHeight="19020" tabRatio="500"/></bookViews><sheets><sheet name="Sheet1" sheetId="1" r:id="rId1"/></sheets></workbook>',"xl/worksheets/sheet1.xml":'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><worksheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" mc:Ignorable="x14ac" xmlns:x14ac="http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac"><sheetData/></worksheet>',"xl/styles.xml":'<?xml version="1.0" encoding="UTF-8"?><styleSheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" mc:Ignorable="x14ac" xmlns:x14ac="http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac"><numFmts count="7"><numFmt numFmtId="164" formatCode="#,##0.00_- [$$-45C]"/><numFmt numFmtId="165" formatCode="&quot;£&quot;#,##0.00"/><numFmt numFmtId="166" formatCode="[$€-2] #,##0.00"/><numFmt numFmtId="167" formatCode="0.0%"/><numFmt numFmtId="168" formatCode="#,##0;(#,##0)"/><numFmt numFmtId="169" formatCode="#,##0.00;(#,##0.00)"/><numFmt numFmtId="170" formatCode="yyyy/mm/dd;@"/></numFmts><fonts count="5" x14ac:knownFonts="1"><font><sz val="11" /><name val="Calibri" /></font><font><sz val="11" /><name val="Calibri" /><color rgb="FFFFFFFF" /></font><font><sz val="11" /><name val="Calibri" /><b /></font><font><sz val="11" /><name val="Calibri" /><i /></font><font><sz val="11" /><name val="Calibri" /><u /></font></fonts><fills count="6"><fill><patternFill patternType="none" /></fill><fill/><fill><patternFill patternType="solid"><fgColor rgb="FFD9D9D9" /><bgColor indexed="64" /></patternFill></fill><fill><patternFill patternType="solid"><fgColor rgb="FFD99795" /><bgColor indexed="64" /></patternFill></fill><fill><patternFill patternType="solid"><fgColor rgb="ffc6efce" /><bgColor indexed="64" /></patternFill></fill><fill><patternFill patternType="solid"><fgColor rgb="ffc6cfef" /><bgColor indexed="64" /></patternFill></fill></fills><borders count="2"><border><left /><right /><top /><bottom /><diagonal /></border><border diagonalUp="false" diagonalDown="false"><left style="thin"><color auto="1" /></left><right style="thin"><color auto="1" /></right><top style="thin"><color auto="1" /></top><bottom style="thin"><color auto="1" /></bottom><diagonal /></border></borders><cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0" /></cellStyleXfs><cellXfs count="67"><xf numFmtId="0" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="1" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="2" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="3" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="4" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="0" fillId="2" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="1" fillId="2" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="2" fillId="2" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="3" fillId="2" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="4" fillId="2" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="0" fillId="3" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="1" fillId="3" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="2" fillId="3" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="3" fillId="3" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="4" fillId="3" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="0" fillId="4" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="1" fillId="4" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="2" fillId="4" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="3" fillId="4" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="4" fillId="4" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="0" fillId="5" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="1" fillId="5" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="2" fillId="5" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="3" fillId="5" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="4" fillId="5" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="0" fillId="0" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="1" fillId="0" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="2" fillId="0" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="3" fillId="0" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="4" fillId="0" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="0" fillId="2" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="1" fillId="2" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="2" fillId="2" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="3" fillId="2" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="4" fillId="2" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="0" fillId="3" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="1" fillId="3" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="2" fillId="3" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="3" fillId="3" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="4" fillId="3" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="0" fillId="4" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="1" fillId="4" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="2" fillId="4" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="3" fillId="4" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="4" fillId="4" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="0" fillId="5" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="1" fillId="5" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="2" fillId="5" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="3" fillId="5" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="4" fillId="5" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyAlignment="1"><alignment horizontal="left"/></xf><xf numFmtId="0" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyAlignment="1"><alignment horizontal="center"/></xf><xf numFmtId="0" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyAlignment="1"><alignment horizontal="right"/></xf><xf numFmtId="0" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyAlignment="1"><alignment horizontal="fill"/></xf><xf numFmtId="0" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyAlignment="1"><alignment textRotation="90"/></xf><xf numFmtId="0" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyAlignment="1"><alignment wrapText="1"/></xf><xf numFmtId="9"   fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyNumberFormat="1"/><xf numFmtId="164" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyNumberFormat="1"/><xf numFmtId="165" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyNumberFormat="1"/><xf numFmtId="166" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyNumberFormat="1"/><xf numFmtId="167" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyNumberFormat="1"/><xf numFmtId="168" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyNumberFormat="1"/><xf numFmtId="169" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyNumberFormat="1"/><xf numFmtId="3" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyNumberFormat="1"/><xf numFmtId="4" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyNumberFormat="1"/><xf numFmtId="1" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyNumberFormat="1"/><xf numFmtId="2" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyNumberFormat="1"/><xf numFmtId="170" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyNumberFormat="1"/></cellXfs><cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0" /></cellStyles><dxfs count="0" /><tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleMedium4" /></styleSheet>'},excelParsers:[{match:/^\-?\d+\.\d%$/,style:60,fmt:function(e){return e/100}},{match:/^\-?\d+\.?\d*%$/,style:56,fmt:function(e){return e/100}},{match:/^\-?\$[\d,]+.?\d*$/,style:57},{match:/^\-?£[\d,]+.?\d*$/,style:58},{match:/^\-?€[\d,]+.?\d*$/,style:59},{match:/^\-?\d+$/,style:65},{match:/^\-?\d+\.\d{2}$/,style:66},{match:/^\([\d,]+\)$/,style:61,fmt:function(e){return-1*e.replace(/[\(\)]/g,"")}},{match:/^\([\d,]+\.\d{2}\)$/,style:62,fmt:function(e){return-1*e.replace(/[\(\)]/g,"")}},{match:/^\-?[\d,]+$/,style:63},{match:/^\-?[\d,]+\.\d{2}$/,style:64},{match:/^\d{4}\-\d{2}\-\d{2}$/,style:67},{match:/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/gi,style:4}]}),R.jgrid.extend({exportToCsv:function(k){k=R.extend(!0,{separator:",",separatorReplace:" ",quote:'"',escquote:'"',newLine:"\r\n",replaceNewLine:" ",includeCaption:!0,includeLabels:!0,includeGroupHeader:!0,includeFooter:!0,includeHeader:!0,fileName:"jqGridExport.csv",mimetype:"text/csv;charset=utf-8",returnAsString:!1,onBeforeExport:null,treeindent:" ",loadIndicator:!0},k||{});var T="";if(this.each(function(){k._regexsep=new RegExp(k.separator,"g"),k._regexquot=new RegExp(k.quote,"g");var e,t,j=this,r=j.p.treeGrid?R(j).jqGrid("getRowData",null,!0,k.treeindent):j.addLocalData(!0),l=r.length,o=j.p.colModel,a=o.length,n=j.p.colNames,d=0,i="",p="",s="",m="",f="",u=[],c="";R.isFunction(k.loadIndicator)?k.loadIndicator("show"):k.loadIndicator&&R(j).jqGrid("progressBar",{method:"show",loadtype:j.p.loadui,htmlcontent:R.jgrid.getRegional(j,"defaults.loadtext")});var g=[];if(R.each(o,function(e,t){t._expcol=!0,void 0===t.exportcol?t.hidden&&(t._expcol=!1):t._expcol=t.exportcol,"cb"!==t.name&&"rn"!==t.name&&"subgrid"!==t.name||(t._expcol=!1),t._expcol&&(u.push(R.jgrid.formatCellCsv(n[e],k)),g.push(t.name))}),k.includeLabels&&(f=u.join(k.separator)+k.newLine),k.collen=u.length,j.p.grouping){var y=!!j.p.groupingView._locgr;j.p.groupingView._locgr=!1,i+=function(m,f){function u(e,t,r,l){for(var o,a,n=function(e,t,r){var l,o=!1;if(0===t)o=r[e];else{var a=r[e].idx;if(0===a)o=r[e];else for(l=e;0<=l;l--)if(r[l].idx===a-t){o=r[l];break}}return o}(e,t,r),d=n.cnt,i=new Array(f.collen),p=0,s=l;s<I;s++){x[s]._excol&&(a="{0}",R.each(n.summary,function(){if(this.nm===x[s].name){x[s].summaryTpl&&(a=x[s].summaryTpl),"string"==typeof this.st&&"avg"===this.st.toLowerCase()&&(this.sd&&this.vd?this.v=this.v/this.vd:this.v&&0<d&&(this.v=this.v/d));try{this.groupCount=n.cnt,this.groupIndex=n.dataIndex,this.groupValue=n.value,o=j.formatter("",this.v,s,this)}catch(e){o=this.v}return i[p]=R.jgrid.formatCellCsv(R.jgrid.stripHtml(R.jgrid.template(a,o)),f),!1}}),p++)}return i}var c="",g=j.p.groupingView,y=[],h=g.groupField.length,x=j.p.colModel,I=x.length,F=0;R.each(x,function(e,t){for(var r=0;r<h;r++)if(g.groupField[r]===t.name){y[r]=e;break}});var v,b,w=R.makeArray(g.groupSummary);if(w.reverse(),"local"===j.p.datatype&&!j.p.loadonce){R(j).jqGrid("groupingSetup");for(var e=R.jgrid.getMethod("groupingPrepare"),t=0;t<l;t++)e.call(R(j),r[t],t)}return R.each(g.groups,function(e,t){F++;try{v=R.isArray(g.formatDisplayField)&&R.isFunction(g.formatDisplayField[t.idx])?g.formatDisplayField[t.idx].call(j,t.displayValue,t.value,j.p.colModel[y[t.idx]],t.idx,g):j.formatter("",t.displayValue,y[t.idx],t.value)}catch(e){v=t.displayValue}var r,l="";if("string"!=typeof(l=R.isFunction(g.groupText[t.idx])?g.groupText[t.idx].call(j,v,t.cnt,t.summary):R.jgrid.template(g.groupText[t.idx],v,t.cnt,t.summary))&&"number"!=typeof l&&(l=v),(r="header"===g.groupSummaryPos[t.idx]?u(e,0,g.groups,0):new Array(f.collen))[0]=R.jgrid.formatCellCsv(R.jgrid.stripHtml(l),f),c+=r.join(f.separator)+f.newLine,h-1===t.idx){for(var o,a,n,d=g.groups[e+1],i=t.startRow,p=void 0!==d?d.startRow:g.groups[e].startRow+g.groups[e].cnt,s=i;s<p&&m[+s];s++){for(a=m[+s],o=b=0;o<x.length;o++)x[o]._expcol&&(r[b]=R.jgrid.formatCellCsv(R.jgrid.formatCell(R.jgrid.getAccessor(a,x[o].name),o,a,x[o],j,"csv"),f),b++);c+=r.join(f.separator)+f.newLine}if("header"!==g.groupSummaryPos[t.idx]){if(void 0!==d){for(n=0;n<g.groupField.length&&d.dataIndex!==g.groupField[n];n++);F=g.groupField.length-n}for(o=0;o<F;o++)w[o]&&(r=u(e,o,g.groups,0),c+=r.join(f.separator)+f.newLine);F=n}}}),c}(r,k),j.p.groupingView._locgr=y}else for(;d<l;){for(e=r[d],F=[],x=t=0;x<a;x++)o[x]._expcol&&(F[t]=R.jgrid.formatCellCsv(R.jgrid.formatCell(R.jgrid.getAccessor(e,o[x].name),x,e,o[x],j,"csv"),k),t++);i+=F.join(k.separator)+k.newLine,d++}if(r=null,F=new Array(k.collen),k.includeCaption&&j.p.caption){for(d=k.collen;--d;)F[d]="";F[0]=R.jgrid.formatCellCsv(j.p.caption,k),p+=F.join(k.separator)+k.newLine}if(k.includeGroupHeader&&j.p.groupHeader&&j.p.groupHeader.length)for(var h=j.p.groupHeader,x=0;x<h.length;x++){for(var I=h[x].groupHeaders,d=0,F=[],v=0;v<g.length;v++){for(F[d]="",t=0;t<I.length;t++)I[t].startColumnName===g[v]&&(F[d]=R.jgrid.formatCellCsv(I[t].titleText,k));d++}s+=F.join(k.separator)+k.newLine}if(k.includeFooter&&j.p.footerrow&&R(".ui-jqgrid-ftable",this.sDiv).length){var b=R(j).jqGrid("footerData","get");for(x=0,F=[];x<k.collen;){var w=g[x];b.hasOwnProperty(w)&&F.push(R.jgrid.formatCellCsv(R.jgrid.stripHtml(b[w]),k)),x++}m+=F.join(k.separator)+k.newLine}if(k.includeHeader&&j.p.headerrow){var C=R(j).jqGrid("headerData","get");for(x=0,F=[];x<k.collen;){var B=g[x];C.hasOwnProperty(B)&&F.push(R.jgrid.formatCellCsv(R.jgrid.stripHtml(C[B]),k)),x++}c+=F.join(k.separator)+k.newLine}T=p+s+f+c+i+m,R.isFunction(k.loadIndicator)?k.loadIndicator("hide"):k.loadIndicator&&R(j).jqGrid("progressBar",{method:"hide",loadtype:j.p.loadui})}),k.returnAsString)return T;if(-1!==k.mimetype.toUpperCase().indexOf("UTF-8")&&(T="\ufeff"+T),R.isFunction(k.onBeforeExport)&&!(T=k.onBeforeExport(T)))throw"Before export does not return data!";R.jgrid.saveAs(T,k.fileName,{type:k.mimetype})},exportToExcel:function(E){E=R.extend(!0,{includeLabels:!0,includeGroupHeader:!0,includeFooter:!0,includeHeader:!0,fileName:"jqGridExport.xlsx",mimetype:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",maxlength:40,onBeforeExport:null,replaceStr:null,treeindent:" ",loadIndicator:!0},E||{}),this.each(function(){function h(e,t){return R.jgrid.makeNode(v,"c",{attr:e,children:[R.jgrid.makeNode(v,"v",{text:t})]})}function x(e,t){return R.jgrid.makeNode(v,"c",{attr:{t:"inlineStr",r:e},children:{row:R.jgrid.makeNode(v,"is",{children:{row:R.jgrid.makeNode(v,"t",{text:t})}})}})}for(var F=this,e=R.jgrid.excelStrings,I=0,v=R.parseXML(e["xl/worksheets/sheet1.xml"]),b=v.getElementsByTagName("sheetData")[0],o=R.parseXML(e["xl/styles.xml"]),a=o.getElementsByTagName("numFmts")[0],n=R(a.getElementsByTagName("numFmt")),d=o.getElementsByTagName("cellXfs")[0],t={_rels:{".rels":R.parseXML(e["_rels/.rels"])},xl:{_rels:{"workbook.xml.rels":R.parseXML(e["xl/_rels/workbook.xml.rels"])},"workbook.xml":R.parseXML(e["xl/workbook.xml"]),"styles.xml":o,worksheets:{"sheet1.xml":v}},"[Content_Types].xml":R.parseXML(e["[Content_Types].xml"])},w=F.p.colModel,r=0,j={body:F.p.treeGrid?R(F).jqGrid("getRowData",null,!0,E.treeindent):F.addLocalData(!0),header:[],footer:[],width:[],map:[],parser:[]},l=function(e){var r,l,t;return R.isEmptyObject(e)?e.excel_parsers=!0:e.excel_format&&!e.excel_style&&(l=r=0,R.each(n,function(e,t){r++,l=Math.max(l,parseInt(R(t).attr("numFmtId"),10))}),t=R.jgrid.makeNode(o,"numFmt",{attr:{numFmtId:l+1,formatCode:e.excel_format}}),a.appendChild(t),R(a).attr("count",r+1),r=0,t=R.jgrid.makeNode(o,"xf",{attr:{numFmtId:l+1+"",fontId:"0",fillId:"0",borderId:"0",applyFont:"1",applyFill:"1",applyBorder:"1",xfId:"0",applyNumberFormat:"1"}}),d.appendChild(t),r=parseInt(R(d).attr("count"),10),R(d).attr("count",r+1),e.excel_style=r+1),e},i=0,p=w.length;i<p;i++)w[i]._expcol=!0,void 0===w[i].exportcol?w[i].hidden&&(w[i]._expcol=!1):w[i]._expcol=w[i].exportcol,"cb"!==w[i].name&&"rn"!==w[i].name&&"subgrid"!==w[i].name&&w[i]._expcol&&(j.header[r]=w[i].name,j.width[r]=5,j.map[r]=i,j.parser[i]=l(w[i].hasOwnProperty("exportoptions")?w[i].exportoptions:{}),r++);var C,B,k=R.isFunction(E.replaceStr)?E.replaceStr:function(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/[\x00-\x09\x0B\x0C\x0E-\x1F\x7F-\x9F]/g,"")},T=function(e,t){C=I+1,B=R.jgrid.makeNode(v,"row",{attr:{r:C}});for(var r,l,o,a,n,d=0;d<j.header.length;d++){var i,p,s=R.jgrid.excelCellPos(d)+""+C;null==(y=R.isArray(e)&&t?F.p.colNames[j.map[d]]:R.jgrid.getAccessor(e,j.header[d]))&&(y=""),t||(y=R.jgrid.formatCell(y,j.map[d],e,w[j.map[d]],F,"excel")),j.width[d]=Math.max(j.width[d],Math.min(parseInt(y.toString().length,10),E.maxlength)),i=null;var m=j.parser[j.map[d]];if(!0!==m.excel_parsers||t)void 0===m.excel_format||void 0===m.excel_style||t||i||(m.replace_format&&(y=m.replace_format(y)),i=h({r:s,s:m.excel_style},y),B.appendChild(i));else for(var f=0,u=R.jgrid.excelParsers.length;f<u;f++){var c=R.jgrid.excelParsers[f];if(y.match&&!y.match(/^0\d+/)&&y.match(c.match)){var g=y,y=y.replace(/[^\d\.\-]/g,"");if(c.fmt&&(y=c.fmt(y)),67===c.style)i=h({t:"d",r:s,s:c.style},y);else if(4===c.style)o=g,n=a=void 0,(a=document.createElement("div")).innerHTML=o,i=(y="A"===(n=a.firstChild).nodeName?[n.href,n.text]:"#text"===n.nodeName&&[n.textContent,n.textContent])?(r={t:"str",r:s,s:c.style},l='HYPERLINK("'+y[0]+'","'+y[1]+'")',R.jgrid.makeNode(v,"c",{attr:r,children:[R.jgrid.makeNode(v,"f",{text:l})]})):x(s,g);else{if(R.inArray(c.style,["63","64","65","66"])&&15<y.toString().length){i=x(s,g.replace?k(g):g),B.appendChild(i);break}i=h({r:s,s:c.style},y)}B.appendChild(i);break}}i||(y.match&&(p=y.match(/^-?([1-9]\d+)(\.(\d+))?$/)),i="number"==typeof y&&y.toString().length<=15||p&&p[1].length+(p[2]?p[3].length:0)<=15?h({t:"n",r:s},y):x(s,y.replace?k(y):y),B.appendChild(i))}b.appendChild(B),I++};if(R.isFunction(E.loadIndicator)?E.loadIndicator("show"):E.loadIndicator&&R(F).jqGrid("progressBar",{method:"show",loadtype:F.p.loadui,htmlcontent:R.jgrid.getRegional(F,"defaults.loadtext")}),R("sheets sheet",t.xl["workbook.xml"]).attr("name",E.sheetName),E.includeGroupHeader&&F.p.groupHeader&&F.p.groupHeader.length){for(var s,m=F.p.groupHeader,f=[],u=0,c=0;c<m.length;c++){var g=m[c].groupHeaders,y={};for(u++,i=i=0;i<j.header.length;i++){y[s=j.header[i]]="";for(var _,N,S=0;S<g.length;S++){g[S].startColumnName===s&&(y[s]=g[S].titleText,_=R.jgrid.excelCellPos(i)+u,N=R.jgrid.excelCellPos(i+g[S].numberOfColumns-1)+u,f.push({ref:_+":"+N}))}}T(y,!0)}R("row c",v).attr("s","2");var H=R.jgrid.makeNode(v,"mergeCells",{attr:{count:f.length}});for(R("worksheet",v).append(H),r=0;r<f.length;r++)H.appendChild(R.jgrid.makeNode(v,"mergeCell",{attr:f[r]}))}if(E.includeLabels&&(T(j.header,!0),R("row:last c",v).attr("s","2")),E.includeHeader||F.p.headerrow){var A=R(F).jqGrid("headerData","get");for(r in A)A.hasOwnProperty(r)&&(A[r]=R.jgrid.stripHtml(A[r]));T(A,!1),R("row:last c",v).attr("s","2")}if(F.p.grouping){var D=!!F.p.groupingView._locgr;F.p.groupingView._locgr=!1,function(m){function f(e,t,r,l){for(var o,a,n=function(e,t,r){var l,o=!1;if(0===t)o=r[e];else{var a=r[e].idx;if(0===a)o=r[e];else for(l=e;0<=l;l--)if(r[l].idx===a-t){o=r[l];break}}return o}(e,t,r),d=n.cnt,i=u(j.header),p=l;p<s;p++){w[p]._expcol&&(a="{0}",R.each(n.summary,function(){if(this.nm===w[p].name){w[p].summaryTpl&&(a=w[p].summaryTpl),"string"==typeof this.st&&"avg"===this.st.toLowerCase()&&(this.sd&&this.vd?this.v=this.v/this.vd:this.v&&0<d&&(this.v=this.v/d));try{this.groupCount=n.cnt,this.groupIndex=n.dataIndex,this.groupValue=n.value,o=F.formatter("",this.v,p,this)}catch(e){o=this.v}return i[this.nm]=R.jgrid.stripHtml(R.jgrid.template(a,o)),!1}}))}return i}function u(e){for(var t={},r=0;r<e.length;r++)t[e[r]]="";return t}var c=F.p.groupingView,g=[],y=c.groupField.length,s=w.length,h=0;R.each(w,function(e,t){for(var r=0;r<y;r++)if(c.groupField[r]===t.name){g[r]=e;break}});var x,I=R.makeArray(c.groupSummary);if(I.reverse(),"local"===F.p.datatype&&!F.p.loadonce){R(F).jqGrid("groupingSetup");for(var e=R.jgrid.getMethod("groupingPrepare"),t=0;t<j.body.length;t++)e.call(R(F),j.body[t],t)}R.each(c.groups,function(e,t){h++;try{x=R.isArray(c.formatDisplayField)&&R.isFunction(c.formatDisplayField[t.idx])?c.formatDisplayField[t.idx].call(F,t.displayValue,t.value,F.p.colModel[g[t.idx]],t.idx,c):F.formatter("",t.displayValue,g[t.idx],t.value)}catch(e){x=t.displayValue}var r,l="";if("string"!=typeof(l=R.isFunction(c.groupText[t.idx])?c.groupText[t.idx].call(F,x,t.cnt,t.summary):R.jgrid.template(c.groupText[t.idx],x,t.cnt,t.summary))&&"number"!=typeof l&&(l=x),(r="header"===c.groupSummaryPos[t.idx]?f(e,0,c.groups,0):u(j.header))[Object.keys(r)[0]]=R.jgrid.stripHtml(new Array(5*t.idx).join(" ")+l),T(r,!0),y-1===t.idx){for(var o,a,n=c.groups[e+1],d=t.startRow,i=void 0!==n?n.startRow:c.groups[e].startRow+c.groups[e].cnt,p=d;p<i&&m[+p];p++){var s=m[+p];T(s,!1)}if("header"!==c.groupSummaryPos[t.idx]){if(void 0!==n){for(a=0;a<c.groupField.length&&n.dataIndex!==c.groupField[a];a++);h=c.groupField.length-a}for(o=0;o<h;o++)I[o]&&(r=f(e,o,c.groups,0),T(r,!0));h=a}}})}(j.body),F.p.groupingView._locgr=D}else for(var q=0,L=j.body.length;q<L;q++)T(j.body[q],!1);if(E.includeFooter||F.p.footerrow){for(r in j.footer=R(F).jqGrid("footerData","get"),j.footer)j.footer.hasOwnProperty(r)&&(j.footer[r]=R.jgrid.stripHtml(j.footer[r]));T(j.footer,!1),R("row:last c",v).attr("s","2")}var P=R.jgrid.makeNode(v,"cols");for(R("worksheet",v).prepend(P),r=0,p=j.width.length;r<p;r++)P.appendChild(R.jgrid.makeNode(v,"col",{attr:{min:r+1,max:r+1,width:j.width[r],customWidth:1}}));R.isFunction(E.onBeforeExport)&&E.onBeforeExport(t,I),j=null;try{var G=new JSZip,V={type:"blob",mimeType:E.mimetype};R.jgrid.xmlToZip(G,t),G.generateAsync?G.generateAsync(V).then(function(e){R.jgrid.saveAs(e,E.fileName,{type:E.mimetype})}):R.jgrid.saveAs(G.generate(V),E.fileName,{type:E.mimetype})}catch(e){throw e}finally{R.isFunction(E.loadIndicator)?E.loadIndicator("hide"):E.loadIndicator&&R(F).jqGrid("progressBar",{method:"hide",loadtype:F.p.loadui})}})},exportToPdf:function(F){return F=R.extend(!0,{title:null,orientation:"portrait",pageSize:"A4",description:null,onBeforeExport:null,download:"download",includeLabels:!0,includeGroupHeader:!0,includeFooter:!0,includeHeader:!0,fileName:"jqGridExport.pdf",mimetype:"application/pdf",treeindent:"-",loadIndicator:!0},F||{}),this.each(function(){var e,t,r,b=this,w=[],l=b.p.colModel,a={},n=b.p.treeGrid?R(b).jqGrid("getRowData",null,!0,F.treeindent):b.addLocalData(!0),j=[],d=0,i=[],o=[],p=[],C={};for(R.isFunction(F.loadIndicator)?F.loadIndicator("show"):F.loadIndicator&&R(b).jqGrid("progressBar",{method:"show",loadtype:b.p.loadui,htmlcontent:R.jgrid.getRegional(b,"defaults.loadtext")}),e=0,y=l.length;e<y;e++)l[e]._expcol=!0,void 0===l[e].exportcol?l[e].hidden&&(l[e]._expcol=!1):l[e]._expcol=l[e].exportcol,"cb"!==l[e].name&&"rn"!==l[e].name&&"subgrid"!==l[e].name&&l[e]._expcol&&(a={text:b.p.colNames[e],style:"tableHeader"},o.push(a),j[d]=l[e].name,i[d]=e,p.push(l[e].width),C[l[e].name]=l[e].align||"left",d++);if(F.includeGroupHeader&&b.p.groupHeader&&b.p.groupHeader.length)for(r=b.p.groupHeader,d=0;d<r.length;d++){for(var s=[],m=r[d].groupHeaders,f=0;f<j.length;f++){for(a={text:"",style:"tableHeader"},t=0;t<m.length;t++)m[t].startColumnName===j[f]&&(a={text:m[t].titleText,colSpan:m[t].numberOfColumns,style:"tableHeader"});s.push(a),e++}w.push(s)}if(F.includeLabels&&w.push(o),F.includeHeader&&b.p.headerrow){var u=R(b).jqGrid("headerData","get"),o=[];for(f=0;f<j.length;f++)a={text:R.jgrid.stripHtml(R.jgrid.getAccessor(u,j[f])),style:"tableFooter",alignment:C[j[f]]},o.push(a);w.push(o)}if(b.p.grouping){var c=!!b.p.groupingView._locgr;b.p.groupingView._locgr=!1,function(m){function f(e,t){for(var r=0,l=[],o=0;o<j.length;o++)a={text:null==e[j[o]]?"":t?R.jgrid.formatCell(e[j[o]]+"",i[r],n[d],s[i[r]],b,"pdf"):e[j[o]],alignment:C[o],style:"tableBody"},l.push(a),r++;return l}function u(e,t,r,l){for(var o,a,n=function(e,t,r){var l,o=!1;if(0===t)o=r[e];else{var a=r[e].idx;if(0===a)o=r[e];else for(l=e;0<=l;l--)if(r[l].idx===a-t){o=r[l];break}}return o}(e,t,r),d=n.cnt,i=c(j),p=l;p<x;p++){s[p]._expcol&&(a="{0}",R.each(n.summary,function(){if(this.nm===s[p].name){s[p].summaryTpl&&(a=s[p].summaryTpl),"string"==typeof this.st&&"avg"===this.st.toLowerCase()&&(this.sd&&this.vd?this.v=this.v/this.vd:this.v&&0<d&&(this.v=this.v/d));try{this.groupCount=n.cnt,this.groupIndex=n.dataIndex,this.groupValue=n.value,o=b.formatter("",this.v,p,this)}catch(e){o=this.v}return i[this.nm]=R.jgrid.stripHtml(R.jgrid.template(a,o)),!1}}))}return i}function c(e){for(var t={},r=0;r<e.length;r++)t[e[r]]="";return t}var g=b.p.groupingView,y=[],h=g.groupField.length,s=b.p.colModel,x=s.length,I=0;R.each(s,function(e,t){for(var r=0;r<h;r++)if(g.groupField[r]===t.name){y[r]=e;break}});var F,v=R.makeArray(g.groupSummary);if(v.reverse(),"local"===b.p.datatype&&!b.p.loadonce){R(b).jqGrid("groupingSetup");for(var e=R.jgrid.getMethod("groupingPrepare"),t=0;t<n.length;t++)e.call(R(b),n[t],t)}R.each(g.groups,function(e,t){I++;try{F=R.isArray(g.formatDisplayField)&&R.isFunction(g.formatDisplayField[t.idx])?g.formatDisplayField[t.idx].call(b,t.displayValue,t.value,b.p.colModel[y[t.idx]],t.idx,g):b.formatter("",t.displayValue,y[t.idx],t.value)}catch(e){F=t.displayValue}var r,l="";if("string"!=typeof(l=R.isFunction(g.groupText[t.idx])?g.groupText[t.idx].call(b,F,t.cnt,t.summary):R.jgrid.template(g.groupText[t.idx],F,t.cnt,t.summary))&&"number"!=typeof l&&(l=F),(r="header"===g.groupSummaryPos[t.idx]?u(e,0,g.groups,0):c(j))[Object.keys(r)[0]]=R.jgrid.stripHtml(new Array(5*t.idx).join(" ")+l),w.push(f(r,!1)),h-1===t.idx){for(var o,a,n=g.groups[e+1],d=t.startRow,i=void 0!==n?n.startRow:g.groups[e].startRow+g.groups[e].cnt,p=d;p<i&&m[+p];p++){var s=m[+p];w.push(f(s,!0))}if("header"!==g.groupSummaryPos[t.idx]){if(void 0!==n){for(a=0;a<g.groupField.length&&n.dataIndex!==g.groupField[a];a++);I=g.groupField.length-a}for(o=0;o<I;o++)v[o]&&(r=u(e,o,g.groups,0),w.push(f(r,!1)));I=a}}})}(n),b.p.groupingView._locgr=c}else for(var g,d=0,y=n.length;d<y;d++){for(t=0,o=[],g=n[d],f=0;f<j.length;f++)a={text:null==g[j[f]]?"":R.jgrid.stripHtml(R.jgrid.formatCell(R.jgrid.getAccessor(g,j[f])+"",i[t],n[d],l[i[t]],b,"pdf")),alignment:C[j[f]],style:"tableBody"},o.push(a),t++;w.push(o)}if(F.includeFooter&&b.p.footerrow){var h=R(b).jqGrid("footerData","get");for(o=[],f=0;f<j.length;f++)a={text:R.jgrid.stripHtml(R.jgrid.getAccessor(h,j[f])),style:"tableFooter",alignment:C[j[f]]},o.push(a);w.push(o)}var x={pageSize:F.pageSize,pageOrientation:F.orientation,content:[{style:"tableExample",widths:p,table:{headerRows:null!=r?0:1,body:w}}],styles:{tableHeader:{bold:!0,fontSize:11,color:"#2e6e9e",fillColor:"#dfeffc",alignment:"center"},tableBody:{fontSize:10},tableFooter:{bold:!0,fontSize:11,color:"#2e6e9e",fillColor:"#dfeffc"},title:{alignment:"center",fontSize:15},description:{}},defaultStyle:{fontSize:10}};F.description&&x.content.unshift({text:F.description,style:"description",margin:[0,0,0,12]}),F.title&&x.content.unshift({text:F.title,style:"title",margin:[0,0,0,12]}),R.isFunction(F.onBeforeExport)&&F.onBeforeExport.call(b,x);try{var I=pdfMake.createPdf(x);I.getDataUrl(function(e){R.isFunction(F.loadIndicator)?F.loadIndicator("hide"):F.loadIndicator&&R(b).jqGrid("progressBar",{method:"hide",loadtype:b.p.loadui})}),"open"===F.download?I.open():I.getBuffer(function(e){R.jgrid.saveAs(e,F.fileName,{type:F.mimetype})})}catch(e){throw e}})},exportToHtml:function(s){var f;return s=R.extend(!0,{title:"",onBeforeExport:null,includeLabels:!0,includeGroupHeader:!0,includeFooter:!0,includeHeader:!0,tableClass:"jqgridprint",autoPrint:!1,topText:"",bottomText:"",returnAsString:!1,treeindent:"&nbsp;",loadIndicator:!0},s||{}),this.each(function(){var b=this,m=b.p.colModel,e=0,w={body:b.p.treeGrid?R(b).jqGrid("getRowData",null,!0,s.treeindent):b.addLocalData(!0),header:[],footer:[],width:[],map:[],align:[]},t=0;for(d=m.length;t<d;t++)m[t]._expcol=!0,void 0===m[t].exportcol?m[t].hidden&&(m[t]._expcol=!1):m[t]._expcol=m[t].exportcol,"cb"!==m[t].name&&"rn"!==m[t].name&&"subgrid"!==m[t].name&&m[t]._expcol&&(w.header[e]=m[t].name,w.width[e]=m[t].width,w.map[e]=t,w.align[e]=m[t].align||"left",e++);var r=document.createElement("a"),l=function(e){r.href=e;var t=r.host;return-1===t.indexOf("/")&&0!==r.pathname.indexOf("/")&&(t+="/"),r.protocol+"//"+t+r.pathname+r.search},j=function(e,t,r,l,o){for(var a,n,d="<tr>",i=0,p=w.header.length;i<p&&(n=o?' colspan= "'+w.header.length+'" style=text-align:left':!0===l?" style=width:"+w.width[i]+"px;text-align:"+w.align[i]+";":" style=text-align:"+w.align[i]+";",a=w.header[i],e.hasOwnProperty(a)&&(d+="<"+t+n+">"+(r?R.jgrid.formatCell(R.jgrid.getAccessor(e,a),w.map[i],e,m[w.map[i]],b,"html"):e[a])+"</"+t+">"),!o);i++);return d+"</tr>"};R.isFunction(s.loadIndicator)?s.loadIndicator("show"):s.loadIndicator&&R(b).jqGrid("progressBar",{method:"show",loadtype:b.p.loadui,htmlcontent:R.jgrid.getRegional(b,"defaults.loadtext")});var o,a='<table class="'+s.tableClass+'">';if(s.includeLabels&&(a+="<thead>"+function(e,t,r){for(var l="<tr>",o=0,a=e.length;o<a;o++)l+="<"+t+(!0===r?" style=width:"+w.width[o]+"px;":"")+">"+b.p.colNames[w.map[o]]+"</"+t+">";return l+"</tr>"}(w.header,"th",!0)+"</thead>"),a+="<tbody>",s.includeHeader&&b.p.headerrow&&(o=R(b).jqGrid("headerData","get",null,!1),a+=j(o,"td",!1)),b.p.grouping){var n=!!b.p.groupingView._locgr;b.p.groupingView._locgr=!1,a+=function(f){function u(e,t,r,l){for(var o,a,n=function(e,t,r){var l,o=!1;if(0===t)o=r[e];else{var a=r[e].idx;if(0===a)o=r[e];else for(l=e;0<=l;l--)if(r[l].idx===a-t){o=r[l];break}}return o}(e,t,r),d=n.cnt,i=c(w.header),p=l;p<s;p++){m[p]._expcol&&(a="{0}",R.each(n.summary,function(){if(this.nm===m[p].name){m[p].summaryTpl&&(a=m[p].summaryTpl),"string"==typeof this.st&&"avg"===this.st.toLowerCase()&&(this.sd&&this.vd?this.v=this.v/this.vd:this.v&&0<d&&(this.v=this.v/d));try{this.groupCount=n.cnt,this.groupIndex=n.dataIndex,this.groupValue=n.value,o=b.formatter("",this.v,p,this)}catch(e){o=this.v}return i[this.nm]=R.jgrid.stripHtml(R.jgrid.template(a,o)),!1}}))}return i}function c(e){for(var t={},r=0;r<e.length;r++)t[e[r]]="";return t}var g=b.p.groupingView,y=[],h=g.groupField.length,s=m.length,x=0,I="";R.each(m,function(e,t){for(var r=0;r<h;r++)if(g.groupField[r]===t.name){y[r]=e;break}});var F,v=R.makeArray(g.groupSummary);if(v.reverse(),"local"===b.p.datatype&&!b.p.loadonce){R(b).jqGrid("groupingSetup");for(var e=R.jgrid.getMethod("groupingPrepare"),t=0;t<w.body.length;t++)e.call(R(b),w.body[t],t)}return R.each(g.groups,function(e,t){x++;try{F=R.isArray(g.formatDisplayField)&&R.isFunction(g.formatDisplayField[t.idx])?g.formatDisplayField[t.idx].call(b,t.displayValue,t.value,b.p.colModel[y[t.idx]],t.idx,g):b.formatter("",t.displayValue,y[t.idx],t.value)}catch(e){F=t.displayValue}var r="";"string"!=typeof(r=R.isFunction(g.groupText[t.idx])?g.groupText[t.idx].call(b,F,t.cnt,t.summary):R.jgrid.template(g.groupText[t.idx],F,t.cnt,t.summary))&&"number"!=typeof r&&(r=F);var l,o=!1;if("header"===g.groupSummaryPos[t.idx]?l=u(e,0,g.groups,0):(l=c(w.header),o=!0),l[Object.keys(l)[0]]=new Array(5*t.idx).join(" ")+r,I+=j(l,"td",!1,1===x,o),h-1===t.idx){for(var a,n,d=g.groups[e+1],i=t.startRow,p=void 0!==d?d.startRow:g.groups[e].startRow+g.groups[e].cnt,s=i;s<p&&f[+s];s++){var m=f[+s];I+=j(m,"td",!1)}if("header"!==g.groupSummaryPos[t.idx]){if(void 0!==d){for(n=0;n<g.groupField.length&&d.dataIndex!==g.groupField[n];n++);x=g.groupField.length-n}for(a=0;a<x;a++)v[a]&&(l=u(e,a,g.groups,0),I+=j(l,"td",!1));x=n}}}),I}(w.body),b.p.groupingView._locgr=n}else for(var e=0,d=w.body.length;e<d;e++)a+=j(w.body[e],"td",!0,0===e);if(s.includeFooter&&b.p.footerrow&&(w.footer=R(b).jqGrid("footerData","get",null,!1),a+=j(w.footer,"td",!1)),a+="</tbody>",a+="</table>",s.returnAsString)f=a;else{var i=window.open("","");i.document.close();var p=s.title?"<title>"+s.title+"</title>":"";R("style, link").each(function(){var e;p+=("link"===(e=R(this).clone()[0]).nodeName.toLowerCase()&&(e.href=l(e.href)),e.outerHTML)});try{i.document.head.innerHTML=p}catch(e){R(i.document.head).html(p)}i.document.body.innerHTML=(s.title?"<h1>"+s.title+"</h1>":"")+"<div>"+(s.topText||"")+"</div>"+a+"<div>"+(s.bottomText||"")+"</div>",R(i.document.body).addClass("html-view"),R("img",i.document.body).each(function(e,t){t.setAttribute("src",l(t.getAttribute("src")))}),s.onBeforeExport&&s.onBeforeExport(i),Boolean(i.chrome)?s.autoPrint&&(i.print(),i.close()):setTimeout(function(){s.autoPrint&&(i.print(),i.close())},1e3)}R.isFunction(s.loadIndicator)?s.loadIndicator("hide"):s.loadIndicator&&R(b).jqGrid("progressBar",{method:"hide",loadtype:b.p.loadui})}),f}})});