!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base"],e):e(jQuery)}(function(u){"use strict";u.extend(u.jgrid,{focusableElementsList:[">a[href]",">button:not([disabled])",">area[href]",">input:not([disabled])",">select:not([disabled])",">textarea:not([disabled])",">iframe",">object",">embed",">*[tabindex]",">*[contenteditable]"]}),u.jgrid.extend({ariaBodyGrid:function(e){var f=u.extend({onEnterCell:null},e||{});return this.each(function(){function d(e,t){return!isNaN(e)&&!isNaN(t)&&0<=e&&0<=t&&s.rows.length&&e<s.rows.length&&t<s.p.colModel.length}function i(e,t){var r=s.p.iRow+t,i=s.p.iCol+e,n=s.rows.length,o=0!==e;if(!n)return!1;var a=s.p.colModel.length;return o&&(i<0&&2<=r&&(i=a-1,r--),a<=i&&(i=0,r++)),o||(r<1?(i--,r=n-1,s.rows[r]&&0<=i&&!s.rows[r].cells[i]&&r--):(n<=r||!s.rows[r].cells[i])&&(r=1,i++)),d(r,i)?{row:r,col:i}:!!d(s.p.iRow,s.p.iCol)&&{row:s.p.iRow,col:s.p.iCol}}function r(e,t){var r=i(e,t);if(!r)return!1;for(;u(s.rows[r.row].cells[r.col]).is(":hidden");)if(s.p.iRow=r.row,s.p.iCol=r.col,r=i(e,t),s.p.iRow===r.row&&s.p.iCol===r.col)return!1;return 0!==t&&u(s).jqGrid("setSelection",s.rows[r.row].id,!1,null,!1),r}function n(e){var t=s.p.page,r=s.p.lastpage;(t+=e)<=0&&(t=1),r<t&&(t=r),s.p.page!==t&&(s.p.page=t,s.grid.populate())}var s=this,o=u.jgrid.getMethod("getStyleUI"),l=o(s.p.styleUI+".common","highlight",!0),t=u.jgrid.focusableElementsList.join();u(s).removeAttr("tabindex"),u(s).on("jqGridAfterGridComplete.setAriaGrid",function(e){u("tbody:first>tr:not(.jqgfirstrow)>td:not(:hidden, :has("+t+"))",s).attr("tabindex",-1),u("tbody:first>tr:not(.jqgfirstrow)",s).removeAttr("tabindex"),void 0!==s.p.iRow&&void 0!==s.p.iCol&&s.rows[s.p.iRow]&&u(s.rows[s.p.iRow].cells[s.p.iCol]).attr("tabindex",0).focus(function(){u(this).addClass(l)}).blur(function(){u(this).removeClass(l)})}),s.p.iRow=1,s.p.iCol=u.jgrid.getFirstVisibleCol(s);var a=0,c=0;u(s).on("keydown",function(e){if(!s.p.navigationDisabled||!0!==s.p.navigationDisabled){var t;switch(e.which||e.keyCode){case 38:t=r(0,-1),a=t.row,c=t.col,e.preventDefault();break;case 40:t=r(0,1),a=t.row,c=t.col,e.preventDefault();break;case 37:t=r(-1,0),a=t.row,c=t.col,e.preventDefault();break;case 39:t=r(1,0),a=t.row,c=t.col,e.preventDefault();break;case 36:a=e.ctrlKey?1:s.p.iRow,c=0,e.preventDefault();break;case 35:a=e.ctrlKey?s.rows.length-1:s.p.iRow,c=s.p.colModel.length-1,e.preventDefault();break;case 33:n(-1),c=s.p.iCol,a=s.p.iRow,e.preventDefault();break;case 34:n(1),c=s.p.iCol,(a=s.p.iRow)>s.rows.length-1&&(a=s.rows.length-1,s.p.iRow=s.rows.length-1),e.preventDefault();break;case 13:return void(u.isFunction(f.onEnterCell)&&(f.onEnterCell.call(s,s.rows[s.p.iRow].id,s.p.iRow,s.p.iCol,e),e.preventDefault()));default:return}u(s).jqGrid("focusBodyCell",a,c,o,l)}}),u(s).on("jqGridBeforeSelectRow.ariaGridClick",function(){return!1}),u(s).on("jqGridCellSelect.ariaGridClick",function(e,t,r,i,n){var o,a=n.target;0<s.p.iRow&&0<=s.p.iCol&&u(s.rows[s.p.iRow].cells[s.p.iCol]).attr("tabindex",-1),(u(a).is("td")||u(a).is("th"))&&(s.p.iCol=a.cellIndex,o=u(a).closest("tr.jqgrow"),s.p.iRow=o[0].rowIndex,u(a).attr("tabindex",0).addClass(l).focus().blur(function(){u(this).removeClass(l)}))})})},focusBodyCell:function(a,d,s,l){return this.each(function(){function e(e){return u(o,e)[0]}var t,r=this,i=s||u.jgrid.getMethod("getStyleUI"),n=l||i(r.p.styleUI+".common","highlight",!0),o=u.jgrid.focusableElementsList.join();void 0!==a&&void 0!==d?!isNaN(r.p.iRow)&&!isNaN(r.p.iCol)&&0<=r.p.iCol&&((t=e(r.rows[r.p.iRow].cells[r.p.iCol]))?u(t).attr("tabindex",-1):u(r.rows[r.p.iRow].cells[r.p.iCol]).attr("tabindex",-1)):(a=r.p.iRow,d=r.p.iCol),a=parseInt(a,10),d=parseInt(d,10),0<a&&0<=d&&((t=e(r.rows[a].cells[d]))?u(t).attr("tabindex",0).addClass(n).focus().blur(function(){u(this).removeClass(n)}):u(r.rows[a].cells[d]).attr("tabindex",0).addClass(n).focus().blur(function(){u(this).removeClass(n)}),r.p.iRow=a,r.p.iCol=d)})},resetAriaBody:function(){return this.each(function(){var e=this;u(e).attr("tabindex","0").off("keydown").off("jqGridBeforeSelectRow.ariaGridClick").off("jqGridCellSelect.ariaGridClick").off("jqGridAfterGridComplete.setAriaGrid");var t=u.jgrid.focusableElementsList.join();u("tbody:first>tr:not(.jqgfirstrow)>td:not(:hidden, :has("+t+"))",e).removeAttr("tabindex").off("focus"),u("tbody:first>tr:not(.jqgfirstrow)",e).attr("tabindex",-1)})},ariaHeaderGrid:function(){return this.each(function(){var n=this,e=u.jgrid.getMethod("getStyleUI")(n.p.styleUI+".common","highlight",!0),t=u(".ui-jqgrid-hbox>table:first","#gbox_"+n.p.id);u("tr.ui-jqgrid-labels",t).on("keydown",function(e){var t=n.p.selHeadInd,r=e.which||e.keyCode,i=n.grid.headers.length;switch(r){case 37:if(0<=t-1){for(t--;u(n.grid.headers[t].el).is(":hidden")&&0<=t-1&&!(--t<0););0<=t&&(u(n.grid.headers[t].el).focus(),u(n.grid.headers[n.p.selHeadInd].el).attr("tabindex","-1"),n.p.selHeadInd=t,e.preventDefault())}break;case 39:if(t+1<i){for(t++;u(n.grid.headers[t].el).is(":hidden")&&t+1<i&&!(++t>i-1););t<i&&(u(n.grid.headers[t].el).focus(),u(n.grid.headers[n.p.selHeadInd].el).attr("tabindex","-1"),n.p.selHeadInd=t,e.preventDefault())}break;case 13:u("div:first",n.grid.headers[t].el).trigger("click"),e.preventDefault();break;default:return}}),u("tr.ui-jqgrid-labels>th:not(:hidden)",t).attr("tabindex",-1).focus(function(){u(this).addClass(e).attr("tabindex","0")}).blur(function(){u(this).removeClass(e)}),n.p.selHeadInd=u.jgrid.getFirstVisibleCol(n),u(n.grid.headers[n.p.selHeadInd].el).attr("tabindex","0")})},focusHeaderCell:function(t){return this.each(function(){var e=this;void 0===t&&(t=e.p.selHeadInd),0<=t&&t<e.p.colModel.length&&(u(e.grid.headers[e.p.selHeadInd].el).attr("tabindex","-1"),u(e.grid.headers[t].el).focus(),e.p.selHeadInd=t)})},resetAriaHeader:function(){return this.each(function(){var e=u(".ui-jqgrid-hbox>table:first","#gbox_"+this.p.id);u("tr.ui-jqgrid-labels",e).off("keydown"),u("tr.ui-jqgrid-labels>th:not(:hidden)",e).removeAttr("tabindex").off("focus blur")})},ariaPagerGrid:function(){return this.each(function(){var i=this,e=u.jgrid.getMethod("getStyleUI"),t=e(i.p.styleUI+".common","highlight",!0),n="."+e(i.p.styleUI+".common","disabled",!0),o=u(".ui-pg-button",i.p.pager),a=o.length;o.attr("tabindex","-1").focus(function(){u(this).addClass(t)}).blur(function(){u(this).removeClass(t)}),i.p.navIndex=0,setTimeout(function(){var e=o.not(n).first().attr("tabindex","0");i.p.navIndex=e[0].cellIndex?e[0].cellIndex-1:0},100),u("table.ui-pager-table tr:first",i.p.pager).on("keydown",function(e){var t=e.which||e.keyCode,r=i.p.navIndex;switch(t){case 37:if(0<=r-1){for(r--;u(o[r]).is(n)&&0<=r-1&&!(--r<0););0<=r&&(u(o[i.p.navIndex]).attr("tabindex","-1"),u(o[r]).attr("tabindex","0").focus(),i.p.navIndex=r),e.preventDefault()}break;case 39:if(r+1<a){for(r++;u(o[r]).is(n)&&r+1<a+1&&!(++r>a-1););r<a&&(u(o[i.p.navIndex]).attr("tabindex","-1"),u(o[r]).attr("tabindex","0").focus(),i.p.navIndex=r),e.preventDefault()}break;case 13:u(o[r]).trigger("click"),e.preventDefault();break;default:return}})})},focusPagerCell:function(r){return this.each(function(){var e=u(".ui-pg-button",this.p.pager),t=e.length;void 0===r&&(r=this.p.navIndex),0<=r&&r<t&&(u(e[this.p.navIndex]).attr("tabindex","-1"),u(e[r]).attr("tabindex","0").focus(),this.p.navIndex=r)})},resetAriaPager:function(){return this.each(function(){u(".ui-pg-button",this.p.pager).removeAttr("tabindex").off("focus"),u("table.ui-pager-table tr:first",this.p.pager).off("keydown")})},setAriaGrid:function(e){var t=u.extend({header:!0,body:!0,pager:!0,onEnterCell:null},e||{});return this.each(function(){t.header&&u(this).jqGrid("ariaHeaderGrid"),t.body&&u(this).jqGrid("ariaBodyGrid",{onEnterCell:t.onEnterCell}),t.pager&&u(this).jqGrid("ariaPagerGrid")})},resetAriaGrid:function(e){var t=u.extend({header:!0,body:!0,pager:!0},e||{});return this.each(function(){t.body&&u(this).jqGrid("resetAriaBody"),t.header&&u(this).jqGrid("resetAriaHeader"),t.pager&&u(this).jqGrid("resetAriaPager")})}})});