!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base","jquery-ui/dialog","jquery-ui/draggable","jquery-ui/droppable","jquery-ui/resizable","jquery-ui/sortable","./addons/ui.multiselect"],t):t(jQuery)}(function($){"use strict";var setSelected;$.jgrid.msie()&&8===$.jgrid.msiever()&&($.expr[":"].hidden=function(t){return 0===t.offsetWidth||0===t.offsetHeight||"none"===t.style.display}),$.jgrid._multiselect=!1,$.ui&&$.ui.multiselect&&($.ui.multiselect.prototype._setSelected&&(setSelected=$.ui.multiselect.prototype._setSelected,$.ui.multiselect.prototype._setSelected=function(t,e){var i,o=setSelected.call(this,t,e);return e&&this.selectedList&&(i=this.element,this.selectedList.find("li").each(function(){$(this).data("optionLink")&&$(this).data("optionLink").remove().appendTo(i)})),o}),$.ui.multiselect.prototype.destroy&&($.ui.multiselect.prototype.destroy=function(){this.element.show(),this.container.remove(),void 0===$.Widget?$.widget.prototype.destroy.apply(this,arguments):$.Widget.prototype.destroy.apply(this,arguments)}),$.jgrid._multiselect=!0),$.jgrid.extend({sortableColumns:function(c){return this.each(function(){function i(){d.p.disableClick=!0,d.p.frozenColumns&&($(d).jqGrid("destroyFrozenColumns"),e=!0)}function o(){setTimeout(function(){d.p.disableClick=!1,e&&($(d).jqGrid("setFrozenColumns"),e=!1)},50)}var s,a,d=this,t=$.jgrid.jqID(d.p.id),e=!1,n={tolerance:"pointer",axis:"x",scrollSensitivity:"1",items:">th:not(:has(#jqgh_"+t+"_cb,#jqgh_"+t+"_rn,#jqgh_"+t+"_subgrid),:hidden)",placeholder:{element:function(t){return $(document.createElement(t[0].nodeName)).addClass(t[0].className+" ui-sortable-placeholder ui-state-highlight").removeClass("ui-sortable-helper")[0]},update:function(t,e){e.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),e.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10))}},update:function(t,e){var i=$(e.item).parent(),o=$(">th",i),s=d.p.colModel,a={},n=d.p.id+"_";$.each(s,function(t){a[this.name]=t});var r=[];o.each(function(){var t=$(">div",this).get(0).id.replace(/^jqgh_/,"").replace(n,"");a.hasOwnProperty(t)&&r.push(a[t])}),$(d).jqGrid("remapColumns",r,!0,!0),$.isFunction(d.p.sortable.update)&&d.p.sortable.update(r)}};d.p.sortable.options?$.extend(n,d.p.sortable.options):$.isFunction(d.p.sortable)&&(d.p.sortable={update:d.p.sortable}),n.start?(s=n.start,n.start=function(t,e){i(),s.call(this,t,e)}):n.start=i,n.stop?(a=n.stop,n.stop=function(t,e){o(),a.call(this,t,e)}):n.stop=o,d.p.sortable.exclude&&(n.items+=":not("+d.p.sortable.exclude+")");var r=c.sortable(n),l=r.data("sortable")||r.data("uiSortable");null!=l&&(l.data("sortable").floating=!0)})},columnChooser:function(e){function i(t,e){t&&("string"==typeof t?$.fn[t]&&$.fn[t].apply(e,$.makeArray(arguments).slice(2)):$.isFunction(t)&&t.apply(e,$.makeArray(arguments).slice(2)))}function o(){var t=m(a),e=t.container.closest(".ui-dialog-content");0<e.length&&"object"==typeof e[0].style?e[0].style.width="":e.css("width",""),t.selectedList.height(Math.max(t.selectedContainer.height()-t.selectedActions.outerHeight()-1,1)),t.availableList.height(Math.max(t.availableContainer.height()-t.availableActions.outerHeight()-1,1))}var s,a,t,n,r,d,l,c=this,p={},u=[],h=c.jqGrid("getGridParam","colModel"),g=c.jqGrid("getGridParam","colNames"),m=function(t){return $.ui.multiselect.prototype&&t.data($.ui.multiselect.prototype.widgetFullName||$.ui.multiselect.prototype.widgetName)||t.data("ui-multiselect")||t.data("multiselect")},f=$.jgrid.getRegional(this[0],"col");if(!$("#colchooser_"+$.jgrid.jqID(c[0].p.id)).length){if(s=$('<div id="colchooser_'+c[0].p.id+'" style="position:relative;overflow:hidden"><div><select multiple="multiple"></select></div></div>'),a=$("select",s),e=$.extend({width:400,height:240,classname:null,done:function(t){t&&c.jqGrid("remapColumns",t,!0)},msel:"multiselect",dlog:"dialog",dialog_opts:{minWidth:470,dialogClass:"ui-jqdialog"},dlog_opts:function(t){var e={};return e[t.bSubmit]=function(){t.apply_perm(),t.cleanup(!1)},e[t.bCancel]=function(){t.cleanup(!0)},$.extend(!0,{buttons:e,close:function(){t.cleanup(!0)},modal:t.modal||!1,resizable:t.resizable||!0,width:t.width+70,resize:o},t.dialog_opts||{})},apply_perm:function(){var n=[];$("option",a).each(function(){$(this).is(":selected")?c.jqGrid("showCol",h[this.value].name):c.jqGrid("hideCol",h[this.value].name)}),$("option[selected]",a).each(function(){n.push(parseInt(this.value,10))}),$.each(n,function(){delete p[h[parseInt(this,10)].name]}),$.each(p,function(){var t,e,i,o,s,a=parseInt(this,10);t=n,i=e=a,n=0<=e?(s=(o=t.slice()).splice(e,Math.max(t.length-e,e)),e>t.length&&(e=t.length),o[e]=i,o.concat(s)):t}),e.done&&e.done.call(c,n),c.jqGrid("setGridWidth",c[0].p.width,c[0].p.shrinkToFit)},cleanup:function(t){i(e.dlog,s,"destroy"),i(e.msel,a,"destroy"),s.remove(),t&&e.done&&e.done.call(c)},msel_opts:{}},f,e||{}),$.ui&&$.ui.multiselect&&$.ui.multiselect.defaults){if(!$.jgrid._multiselect)return void alert("Multiselect plugin loaded after jqGrid. Please load the plugin before the jqGrid!");e.msel_opts=$.extend($.ui.multiselect.defaults,e.msel_opts)}e.caption&&s.attr("title",e.caption),e.classname&&(s.addClass(e.classname),a.addClass(e.classname)),e.width&&($(">div",s).css({width:e.width,margin:"0 auto"}),a.css("width",e.width)),e.height&&($(">div",s).css("height",e.height),a.css("height",e.height-10)),a.empty(),$.each(h,function(t){p[this.name]=t,this.hidedlg?this.hidden||u.push(t):a.append("<option value='"+t+"' "+(this.hidden?"":"selected='selected'")+">"+$.jgrid.stripHtml(g[t])+"</option>")}),t=$.isFunction(e.dlog_opts)?e.dlog_opts.call(c,e):e.dlog_opts,i(e.dlog,s,t),n=$.isFunction(e.msel_opts)?e.msel_opts.call(c,e):e.msel_opts,i(e.msel,a,n),r=$("#colchooser_"+$.jgrid.jqID(c[0].p.id));var b=$(".ui-jqgrid").css("font-size")||"11px";r.parent().css("font-size",b),r.css({margin:"auto"}),r.find(">div").css({width:"100%",height:"100%",margin:"auto"}),(d=m(a)).container.css({width:"100%",height:"100%",margin:"auto"}),d.selectedContainer.css({width:100*d.options.dividerLocation+"%",height:"100%",margin:"auto",boxSizing:"border-box"}),d.availableContainer.css({width:100-100*d.options.dividerLocation+"%",height:"100%",margin:"auto",boxSizing:"border-box"}),d.selectedList.css("height","auto"),d.availableList.css("height","auto"),l=Math.max(d.selectedList.height(),d.availableList.height()),l=Math.min(l,$(window).height()),d.selectedList.css("height",l),d.availableList.css("height",l),o()}},sortableRows:function(s){return this.each(function(){var o=this;o.grid&&(o.p.treeGrid||$.fn.sortable&&((s=$.extend({cursor:"move",axis:"y",items:" > .jqgrow"},s||{})).start&&$.isFunction(s.start)?(s._start_=s.start,delete s.start):s._start_=!1,s.update&&$.isFunction(s.update)?(s._update_=s.update,delete s.update):s._update_=!1,s.start=function(t,e){if($(e.item).css("border-width","0"),$("td",e.item).each(function(t){this.style.width=o.grid.cols[t].style.width}),o.p.subGrid){var i=$(e.item).attr("id");try{$(o).jqGrid("collapseSubGridRow",i)}catch(t){}}s._start_&&s._start_.apply(this,[t,e])},s.update=function(t,e){$(e.item).css("border-width",""),!0===o.p.rownumbers&&$("td.jqgrid-rownum",o.rows).each(function(t){$(this).html(t+1+(parseInt(o.p.page,10)-1)*parseInt(o.p.rowNum,10))}),s._update_&&s._update_.apply(this,[t,e])},$("tbody:first",o).sortable(s),$("tbody:first > .jqgrow",o).disableSelection()))})},gridDnD:function(o){return this.each(function(){function t(){var t=$.data(a,"dnd");$("tr.jqgrow:not(.ui-draggable)",a).draggable($.isFunction(t.drag)?t.drag.call($(a),t):t.drag)}var e,i,g,a=this;if(a.grid&&!a.p.treeGrid&&$.fn.draggable&&$.fn.droppable){if(void 0===$("#jqgrid_dnd")[0]&&$("body").append("<table id='jqgrid_dnd' class='ui-jqgrid-dnd'></table>"),"string"==typeof o&&"updateDnD"===o&&!0===a.p.jqgdnd)return void t();if((o=$.extend({drag:function(s){return $.extend({start:function(t,e){var i,o;if(a.p.subGrid){o=$(e.helper).attr("id");try{$(a).jqGrid("collapseSubGridRow",o)}catch(t){}}for(i=0;i<$.data(a,"dnd").connectWith.length;i++)0===$($.data(a,"dnd").connectWith[i]).jqGrid("getGridParam","reccount")&&$($.data(a,"dnd").connectWith[i]).jqGrid("addRowData","jqg_empty_row",{});e.helper.addClass("ui-state-highlight"),$("td",e.helper).each(function(t){this.style.width=a.grid.headers[t].width+"px"}),s.onstart&&$.isFunction(s.onstart)&&s.onstart.call($(a),t,e)},stop:function(t,e){var i,o;for(e.helper.dropped&&!s.dragcopy&&(void 0===(o=$(e.helper).attr("id"))&&(o=$(this).attr("id")),$(a).jqGrid("delRowData",o)),i=0;i<$.data(a,"dnd").connectWith.length;i++)$($.data(a,"dnd").connectWith[i]).jqGrid("delRowData","jqg_empty_row");s.onstop&&$.isFunction(s.onstop)&&s.onstop.call($(a),t,e)}},s.drag_opts||{})},drop:function(h){return $.extend({accept:function(t){if(!$(t).hasClass("jqgrow"))return t;g=$(t).closest("table.ui-jqgrid-btable");var e=$(this).find("table.ui-jqgrid-btable:first")[0];if(0<g.length&&void 0!==$.data(g[0],"dnd")){var i=$.data(g[0],"dnd").connectWith;return-1!==$.inArray("#"+$.jgrid.jqID(e.id),i)}return!1},drop:function(t,e){if($(e.draggable).hasClass("jqgrow")){var i,o,s=$(e.draggable).attr("id"),a=e.draggable.parent().parent().jqGrid("getRowData",s),n=[],r=$(this).find("table.ui-jqgrid-btable:first")[0];if($.isPlainObject(a)&&(n=Object.keys(a)),!h.dropbyname){var d,l,c={},p=0,u=$("#"+$.jgrid.jqID(r.id)).jqGrid("getGridParam","colModel");try{for(d=0;d<u.length;d++)"cb"!==(l=u[d].name)&&"rn"!==l&&"subgrid"!==l&&(void 0!==n[p]&&(c[l]=a[n[p]]),p++);a=c}catch(t){}}e.helper.dropped=!0,$.data(g[0],"dnd").beforedrop&&$.isFunction($.data(g[0],"dnd").beforedrop)&&null!=(i=$.data(g[0],"dnd").beforedrop.call(r,t,e,a,$(g[0]),$(r)))&&"object"==typeof i&&(a=i),e.helper.dropped&&(h.autoid&&(o=$.isFunction(h.autoid)?h.autoid.call(r,a):(o=Math.ceil(1e3*Math.random()),h.autoidprefix+o)),$("#"+$.jgrid.jqID(r.id)).jqGrid("addRowData",o,a,h.droppos)),h.ondrop&&$.isFunction(h.ondrop)&&h.ondrop.call(r,t,e,a)}}},h.drop_opts||{})},onstart:null,onstop:null,beforedrop:null,ondrop:null,drop_opts:{activeClass:"ui-state-active",hoverClass:"ui-state-hover",tolerance:"intersect"},drag_opts:{revert:"invalid",helper:"clone",cursor:"move",appendTo:"#jqgrid_dnd",zIndex:5e3},dragcopy:!1,dropbyname:!1,droppos:"first",autoid:!0,autoidprefix:"dnd_"},o||{})).connectWith)for(o.connectWith=o.connectWith.split(","),o.connectWith=$.map(o.connectWith,function(t){return $.trim(t)}),$.data(a,"dnd",o),0===a.p.reccount||a.p.jqgdnd||t(),a.p.jqgdnd=!0,e=0;e<o.connectWith.length;e++)i=o.connectWith[e],$(i).closest(".ui-jqgrid-bdiv").droppable($.isFunction(o.drop)?o.drop.call($(a),o):o.drop)}})},gridResize:function(opts){return this.each(function(){var $t=this,gID=$.jgrid.jqID($t.p.id),req,optstest;$t.grid&&$.fn.resizable&&(opts=$.extend({},opts||{}),opts.alsoResize?(opts._alsoResize_=opts.alsoResize,delete opts.alsoResize):opts._alsoResize_=!1,opts.stop&&$.isFunction(opts.stop)?(opts._stop_=opts.stop,delete opts.stop):opts._stop_=!1,opts.stop=function(t,e){$($t).jqGrid("setGridParam",{height:$("#gview_"+gID+" .ui-jqgrid-bdiv").height()}),$($t).jqGrid("setGridWidth",e.size.width,opts.shrinkToFit),opts._stop_&&opts._stop_.call($t,t,e),$t.p.caption&&$("#gbox_"+gID).css({height:"auto"}),$t.p.frozenColumns&&(req&&clearTimeout(req),req=setTimeout(function(){req&&clearTimeout(req),$("#"+gID).jqGrid("destroyFrozenColumns"),$("#"+gID).jqGrid("setFrozenColumns")}))},opts._alsoResize_?(optstest="{'#gview_"+gID+" .ui-jqgrid-bdiv':true,'"+opts._alsoResize_+"':true}",opts.alsoResize=eval("("+optstest+")")):opts.alsoResize=$(".ui-jqgrid-bdiv","#gview_"+gID),delete opts._alsoResize_,$("#gbox_"+gID).resizable(opts))})}})});