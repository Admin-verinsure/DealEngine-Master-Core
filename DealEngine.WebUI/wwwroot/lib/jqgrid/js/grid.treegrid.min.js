!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base"],e):e(jQuery)}(function(m){"use strict";m.jgrid.extend({setTreeNode:function(j,R){return this.each(function(){var d=this;if(d.grid&&d.p.treeGrid){var e,r,t,i,a,s,l,n=d.p.expColInd,p=d.p.treeReader.expanded_field,o=d.p.treeReader.leaf_field,h=d.p.treeReader.level_field,f=d.p.treeReader.icon_field,c=d.p.treeReader.loaded,g=m.jgrid.styleUI[d.p.styleUI||"jQueryUI"].common,u=j;for(m(d).triggerHandler("jqGridBeforeSetTreeNode",[u,R]),m.isFunction(d.p.beforeSetTreeNode)&&d.p.beforeSetTreeNode.call(d,u,R);j<R;){var G=m.jgrid.stripPref(d.p.idPrefix,d.rows[j].id),v=d.p._index[G],_=d.p.data[v];"nested"===d.p.treeGridModel&&(_[o]||(e=parseInt(_[d.p.treeReader.left_field],10),r=parseInt(_[d.p.treeReader.right_field],10),_[o]=r===e+1?"true":"false",d.rows[j].cells[d.p._treeleafpos].innerHTML=_[o])),t=parseInt(_[h],10),a=0===d.p.tree_root_level?(i=t+1,t):(i=t)-1,s="<div class='tree-wrap tree-wrap-"+d.p.direction+"' style='width:"+18*i+"px;'>",s+="<div style='"+("rtl"===d.p.direction?"right:":"left:")+18*a+"px;' class='"+g.icon_base+" ",void 0!==_[c]&&("true"===_[c]||!0===_[c]?_[c]=!0:_[c]=!1),l="true"===_[o]||!0===_[o]?(s+=(void 0!==_[f]&&""!==_[f]?_[f]:d.p.treeIcons.leaf)+" tree-leaf treeclick",_[o]=!0,"leaf"):(_[o]=!1,""),_[p]=("true"===_[p]||!0===_[p])&&(_[c]||void 0===_[c]),!1===_[p]?s+=!0===_[o]?"'":d.p.treeIcons.plus+" tree-plus treeclick'":s+=!0===_[o]?"'":d.p.treeIcons.minus+" tree-minus treeclick'",s+="></div></div>",m(d.rows[j].cells[n]).wrapInner("<span class='cell-wrapper"+l+"'></span>").prepend(s),t!==parseInt(d.p.tree_root_level,10)&&(m(d).jqGrid("isVisibleNode",_)||m(d.rows[j]).css("display","none")),m(d.rows[j].cells[n]).find("div.treeclick").on("click",function(e){var r=e.target||e.srcElement,t=m.jgrid.stripPref(d.p.idPrefix,m(r,d.rows).closest("tr.jqgrow")[0].id),i=d.p._index[t];return d.p.data[i][o]||(d.p.data[i][p]?(m(d).jqGrid("collapseRow",d.p.data[i]),m(d).jqGrid("collapseNode",d.p.data[i])):(m(d).jqGrid("expandRow",d.p.data[i]),m(d).jqGrid("expandNode",d.p.data[i]))),!1}),!0===d.p.ExpandColClick&&m(d.rows[j].cells[n]).find("span.cell-wrapper").css("cursor","pointer").on("click",function(e){var r=e.target||e.srcElement,t=m.jgrid.stripPref(d.p.idPrefix,m(r,d.rows).closest("tr.jqgrow")[0].id),i=d.p._index[t];return d.p.data[i][o]||(d.p.data[i][p]?(m(d).jqGrid("collapseRow",d.p.data[i]),m(d).jqGrid("collapseNode",d.p.data[i])):(m(d).jqGrid("expandRow",d.p.data[i]),m(d).jqGrid("expandNode",d.p.data[i]))),m(d).jqGrid("setSelection",t),!1}),j++}m(d).triggerHandler("jqGridAfterSetTreeNode",[u,R]),m.isFunction(d.p.afterSetTreeNode)&&d.p.afterSetTreeNode.call(d,u,R)}})},setTreeGrid:function(){return this.each(function(){var e,r,t,i,d=this,a=0,s=!1,l=[],n=m.jgrid.styleUI[d.p.styleUI||"jQueryUI"].treegrid;if(d.p.treeGrid){for(t in d.p.treedatatype||m.extend(d.p,{treedatatype:d.p.datatype}),d.p.loadonce&&(d.p.treedatatype="local"),d.p.subGrid=!1,d.p.altRows=!1,d.p.treeGrid_bigData||(d.p.pgbuttons=!1,d.p.pginput=!1,d.p.rowList=[]),d.p.gridview=!0,null!==d.p.rowTotal||d.p.treeGrid_bigData||(d.p.rowNum=1e4),d.p.multiselect=!1,d.p.expColInd=0,e=n.icon_plus,"jQueryUI"===d.p.styleUI&&(e+="rtl"===d.p.direction?"w":"e"),d.p.treeIcons=m.extend({plus:e,minus:n.icon_minus,leaf:n.icon_leaf},d.p.treeIcons||{}),"nested"===d.p.treeGridModel?d.p.treeReader=m.extend({level_field:"level",left_field:"lft",right_field:"rgt",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},d.p.treeReader):"adjacency"===d.p.treeGridModel&&(d.p.treeReader=m.extend({level_field:"level",parent_id_field:"parent",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},d.p.treeReader)),d.p.colModel)if(d.p.colModel.hasOwnProperty(t))for(i in(r=d.p.colModel[t].name)!==d.p.ExpandColumn||s||(s=!0,d.p.expColInd=a),a++,r!==d.p.treeReader.level_field&&r!==d.p.treeReader.left_field&&r!==d.p.treeReader.right_field||(d.p.colModel[t].sorttype="integer"),d.p.treeReader)d.p.treeReader.hasOwnProperty(i)&&d.p.treeReader[i]===r&&l.push(r);m.each(d.p.treeReader,function(e,r){r&&-1===m.inArray(r,l)&&("leaf_field"===e&&(d.p._treeleafpos=a),a++,d.p.colNames.push(r),d.p.colModel.push({name:r,width:1,hidden:!0,sortable:!1,resizable:!1,hidedlg:!0,editable:!0,search:!1}))})}})},expandRow:function(s){this.each(function(){var e,r,t,i,d,a=this;a.p.treeGrid_bigData||(e=a.p.lastpage),a.grid&&a.p.treeGrid&&(r=m(a).jqGrid("getNodeChildren",s),t=a.p.treeReader.expanded_field,i=s[a.p.localReader.id],void 0===(d=m(a).triggerHandler("jqGridBeforeExpandTreeGridRow",[i,s,r]))&&(d=!0),d&&m.isFunction(a.p.beforeExpandTreeGridRow)&&(d=a.p.beforeExpandTreeGridRow.call(a,i,s,r)),!1!==d&&(m(r).each(function(){var e=a.p.idPrefix+m.jgrid.getAccessor(this,a.p.localReader.id);m(m(a).jqGrid("getGridRowById",e)).css("display",""),this[t]&&m(a).jqGrid("expandRow",this)}),m(a).triggerHandler("jqGridAfterExpandTreeGridRow",[i,s,r]),m.isFunction(a.p.afterExpandTreeGridRow)&&a.p.afterExpandTreeGridRow.call(a,i,s,r),a.p.treeGrid_bigData||(a.p.lastpage=e)))})},collapseRow:function(a){this.each(function(){var e,r,t,i,d=this;d.grid&&d.p.treeGrid&&(e=m(d).jqGrid("getNodeChildren",a),r=d.p.treeReader.expanded_field,t=a[d.p.localReader.id],void 0===(i=m(d).triggerHandler("jqGridBeforeCollapseTreeGridRow",[t,a,e]))&&(i=!0),i&&m.isFunction(d.p.beforeCollapseTreeGridRow)&&(i=d.p.beforeCollapseTreeGridRow.call(d,t,a,e)),!1!==i&&(m(e).each(function(){var e=d.p.idPrefix+m.jgrid.getAccessor(this,d.p.localReader.id);m(m(d).jqGrid("getGridRowById",e)).css("display","none"),this[r]&&m(d).jqGrid("collapseRow",this)}),m(d).triggerHandler("jqGridAfterCollapseTreeGridRow",[t,a,e]),m.isFunction(d.p.afterCollapseTreeGridRow)&&d.p.afterCollapseTreeGridRow.call(d,t,a,e)))})},getRootNodes:function(){var d=[];return this.each(function(){var e,r,t=this,i=t.p.data;if(t.grid&&t.p.treeGrid)switch(t.p.treeGridModel){case"nested":e=t.p.treeReader.level_field,m(i).each(function(){parseInt(this[e],10)===parseInt(t.p.tree_root_level,10)&&d.push(this)});break;case"adjacency":r=t.p.treeReader.parent_id_field,m(i).each(function(){null!==this[r]&&"null"!==String(this[r]).toLowerCase()||d.push(this)})}}),d},getNodeDepth:function(r){var t=null;return this.each(function(){if(this.grid&&this.p.treeGrid){switch(this.p.treeGridModel){case"nested":var e=this.p.treeReader.level_field;t=parseInt(r[e],10)-parseInt(this.p.tree_root_level,10);break;case"adjacency":t=m(this).jqGrid("getNodeAncestors",r).length}}}),t},getNodeParent:function(h){var f=null;return this.each(function(){var e=this;if(e.grid&&e.p.treeGrid)switch(e.p.treeGridModel){case"nested":var r=e.p.treeReader.left_field,t=e.p.treeReader.right_field,i=e.p.treeReader.level_field,d=parseInt(h[r],10),a=parseInt(h[t],10),s=parseInt(h[i],10);m(this.p.data).each(function(){if(parseInt(this[i],10)===s-1&&parseInt(this[r],10)<d&&parseInt(this[t],10)>a)return f=this,!1});break;case"adjacency":for(var l=e.p.treeReader.parent_id_field,n=e.p.localReader.id,p=h[n],o=e.p._index[p];o--;)if(String(e.p.data[o][n])===String(m.jgrid.stripPref(e.p.idPrefix,h[l]))){f=e.p.data[o];break}}}),f},getNodeChildren:function(f){var c=[];return this.each(function(){var e=this;if(e.grid&&e.p.treeGrid){var r,t=this.p.data.length;switch(e.p.treeGridModel){case"nested":for(var i=e.p.treeReader.left_field,d=e.p.treeReader.right_field,a=e.p.treeReader.level_field,s=parseInt(f[i],10),l=parseInt(f[d],10),n=parseInt(f[a],10),p=0;p<t;p++)(r=e.p.data[p])&&parseInt(r[a],10)===n+1&&parseInt(r[i],10)>s&&parseInt(r[d],10)<l&&c.push(r);break;case"adjacency":var o=e.p.treeReader.parent_id_field,h=e.p.localReader.id;for(p=0;p<t;p++)(r=e.p.data[p])&&String(r[o])===String(m.jgrid.stripPref(e.p.idPrefix,f[h]))&&c.push(r)}}}),c},getFullTreeNode:function(h,f){var c=[];return this.each(function(){var r,t,i,d=this,a=d.p.treeReader.expanded_field;if(d.grid&&d.p.treeGrid)switch(null!=f&&"boolean"==typeof f||(f=!1),d.p.treeGridModel){case"nested":var e=d.p.treeReader.left_field,s=d.p.treeReader.right_field,l=d.p.treeReader.level_field,n=parseInt(h[e],10),p=parseInt(h[s],10),o=parseInt(h[l],10);m(this.p.data).each(function(){parseInt(this[l],10)>=o&&parseInt(this[e],10)>=n&&parseInt(this[e],10)<=p&&(f&&(this[a]=!0),c.push(this))});break;case"adjacency":h&&(c.push(h),t=d.p.treeReader.parent_id_field,i=d.p.localReader.id,m(this.p.data).each(function(e){for(r=c.length,e=0;e<r;e++)if(String(m.jgrid.stripPref(d.p.idPrefix,c[e][i]))===String(this[t])){f&&(this[a]=!0),c.push(this);break}}))}}),c},getNodeAncestors:function(r,t,i){var d=[];return void 0===t&&(t=!1),this.each(function(){if(this.grid&&this.p.treeGrid){i=void 0!==i&&this.p.treeReader.expanded_field;for(var e=m(this).jqGrid("getNodeParent",r);e;){if(i)try{e[i]=!0}catch(e){}t?d.unshift(e):d.push(e),e=m(this).jqGrid("getNodeParent",e)}}}),d},isVisibleNode:function(t){var i=!0;return this.each(function(){var e,r;this.grid&&this.p.treeGrid&&(e=m(this).jqGrid("getNodeAncestors",t),r=this.p.treeReader.expanded_field,m(e).each(function(){if(!(i=i&&this[r]))return!1}))}),i},isNodeLoaded:function(i){var d;return this.each(function(){var e,r,t=this;t.grid&&t.p.treeGrid&&(e=t.p.treeReader.leaf_field,r=t.p.treeReader.loaded,d=void 0!==i&&(void 0!==i[r]?i[r]:!!(i[e]||0<m(t).jqGrid("getNodeChildren",i).length)))}),d},setLeaf:function(a,s,l){return this.each(function(){var e,r=m.jgrid.getAccessor(a,this.p.localReader.id),t=m("#"+r,this.grid.bDiv)[0],i=this.p.treeReader.leaf_field;try{var d=this.p._index[r];null!=d&&(this.p.data[d][i]=s)}catch(e){}!0===s?m("div.treeclick",t).removeClass(this.p.treeIcons.minus+" tree-minus "+this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.leaf+" tree-leaf"):!1===s&&(e=this.p.treeIcons.minus+" tree-minus",l&&(e=this.p.treeIcons.plus+" tree-plus"),m("div.treeclick",t).removeClass(this.p.treeIcons.leaf+" tree-leaf").addClass(e))})},reloadNode:function(h,f){return this.each(function(){var e,r,t,i,d,a,s,l,n,p,o;this.grid&&this.p.treeGrid&&(e=this.p.localReader.id,r=this.p.selrow,m(this).jqGrid("delChildren",h[e]),void 0===f&&(f=!1),f||jQuery._data(this,"events").jqGridAfterSetTreeNode||m(this).on("jqGridAfterSetTreeNode.reloadNode",function(){var e,r,t=this.p.treeReader.leaf_field;this.p.reloadnode&&(e=this.p.reloadnode,r=m(this).jqGrid("getNodeChildren",e),e[t]&&r.length?m(this).jqGrid("setLeaf",e,!1):e[t]||0!==r.length||m(this).jqGrid("setLeaf",e,!0)),this.p.reloadnode=!1}),t=this.p.treeReader.expanded_field,i=this.p.treeReader.parent_id_field,d=this.p.treeReader.loaded,a=this.p.treeReader.level_field,s=this.p.treeReader.leaf_field,l=this.p.treeReader.left_field,n=this.p.treeReader.right_field,p=m.jgrid.getAccessor(h,this.p.localReader.id),o=m("#"+p,this.grid.bDiv)[0],h[t]=!0,h[s]||m("div.treeclick",o).removeClass(this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.minus+" tree-minus"),this.p.treeANode=o.rowIndex,this.p.datatype=this.p.treedatatype,this.p.reloadnode=h,f&&(this.p.treeANode=0<o.rowIndex?o.rowIndex-1:1,m(this).jqGrid("delRowData",p)),"nested"===this.p.treeGridModel?m(this).jqGrid("setGridParam",{postData:{nodeid:p,n_left:h[l],n_right:h[n],n_level:h[a]}}):m(this).jqGrid("setGridParam",{postData:{nodeid:p,parentid:h[i],n_level:h[a]}}),m(this).trigger("reloadGrid"),h[d]=!0,"nested"===this.p.treeGridModel?m(this).jqGrid("setGridParam",{selrow:r,postData:{nodeid:"",n_left:"",n_right:"",n_level:""}}):m(this).jqGrid("setGridParam",{selrow:r,postData:{nodeid:"",parentid:"",n_level:""}}))})},expandNode:function(o){return this.each(function(){if(this.grid&&this.p.treeGrid){var e=this.p.treeReader.expanded_field,r=this.p.treeReader.parent_id_field,t=this.p.treeReader.loaded,i=this.p.treeReader.level_field,d=this.p.treeReader.left_field,a=this.p.treeReader.right_field;if(!o[e]){var s=m.jgrid.getAccessor(o,this.p.localReader.id),l=m("#"+this.p.idPrefix+m.jgrid.jqID(s),this.grid.bDiv)[0],n=this.p._index[s],p=m(this).triggerHandler("jqGridBeforeExpandTreeGridNode",[s,o]);if(void 0===p&&(p=!0),p&&m.isFunction(this.p.beforeExpandTreeGridNode)&&(p=this.p.beforeExpandTreeGridNode.call(this,s,o)),!1===p)return;m(this).jqGrid("isNodeLoaded",this.p.data[n])?(o[e]=!0,m("div.treeclick",l).removeClass(this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.minus+" tree-minus")):this.grid.hDiv.loading||(o[e]=!0,m("div.treeclick",l).removeClass(this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.minus+" tree-minus"),this.p.treeANode=l.rowIndex,this.p.datatype=this.p.treedatatype,"nested"===this.p.treeGridModel?m(this).jqGrid("setGridParam",{postData:{nodeid:s,n_left:o[d],n_right:o[a],n_level:o[i]}}):m(this).jqGrid("setGridParam",{postData:{nodeid:s,parentid:o[r],n_level:o[i]}}),m(this).trigger("reloadGrid"),o[t]=!0,"nested"===this.p.treeGridModel?m(this).jqGrid("setGridParam",{postData:{nodeid:"",n_left:"",n_right:"",n_level:""}}):m(this).jqGrid("setGridParam",{postData:{nodeid:"",parentid:"",n_level:""}})),m(this).triggerHandler("jqGridAfterExpandTreeGridNode",[s,o]),m.isFunction(this.p.afterExpandTreeGridNode)&&this.p.afterExpandTreeGridNode.call(this,s,o)}}})},collapseNode:function(d){return this.each(function(){if(this.grid&&this.p.treeGrid){var e=this.p.treeReader.expanded_field;if(d[e]){var r=m.jgrid.getAccessor(d,this.p.localReader.id),t=m("#"+this.p.idPrefix+m.jgrid.jqID(r),this.grid.bDiv)[0],i=m(this).triggerHandler("jqGridBeforeCollapseTreeGridNode",[r,d]);if(void 0===i&&(i=!0),i&&m.isFunction(this.p.beforeCollapseTreeGridNode)&&(i=this.p.beforeCollapseTreeGridNode.call(this,r,d)),(d[e]=!1)===i)return;m("div.treeclick",t).removeClass(this.p.treeIcons.minus+" tree-minus").addClass(this.p.treeIcons.plus+" tree-plus"),m(this).triggerHandler("jqGridAfterCollapseTreeGridNode",[r,d]),m.isFunction(this.p.afterCollapseTreeGridNode)&&this.p.afterCollapseTreeGridNode.call(this,r,d)}}})},SortTree:function(h,f,c,g){return this.each(function(){if(this.grid&&this.p.treeGrid){var e,r,t,i,d,a=[],s=this,l=m(this).jqGrid("getRootNodes",s.p.search),n=m.jgrid.from.call(this,l);for(Boolean(s.p.sortTreeByNodeType)&&(d=s.p.sortTreeNodeOrder&&"desc"===s.p.sortTreeNodeOrder.toLowerCase()?"d":"a",n.orderBy(s.p.treeReader.leaf_field,d,c,g)),n.orderBy(h,f,c,g),e=0,r=(i=n.select()).length;e<r;e++)t=i[e],a.push(t),m(this).jqGrid("collectChildrenSortTree",a,t,h,f,c,g);var p=m(this).jqGrid("getDataIDs"),o=1;m.each(a,function(e){var r=m.jgrid.getAccessor(this,s.p.localReader.id);-1!==m.inArray(r,p)&&(m("#"+m.jgrid.jqID(s.p.id)+" tbody tr:eq("+o+")").after(m("#"+m.jgrid.jqID(s.p.id)+" tbody tr#"+m.jgrid.jqID(r))),o++)}),a=i=n=null}})},searchTree:function(t){var i,d,a,s,l,n,p,o=t.length||0,h=[],f=[],c=[];return this.each(function(){if(this.grid&&this.p.treeGrid&&o)for(i=this.p.localReader.id,p=0;p<o;p++){var e;if(h=m(this).jqGrid("getNodeAncestors",t[p],!0,!0),Boolean(this.p.FullTreeSearchResult)?(e=m(this).jqGrid("getFullTreeNode",t[p],!0),h=h.concat(e)):h.push(t[p]),d=h[0][i],-1===m.inArray(d,f))f.push(d),c=c.concat(h);else for(l=0,a=h.length;l<a;l++){var r=!1;for(n=0,s=c.length;n<s;n++)if(h[l][i]===c[n][i]){r=!0;break}r||c.push(h[l])}}}),c},collectChildrenSortTree:function(s,l,n,p,o,h){return this.each(function(){if(this.grid&&this.p.treeGrid){var e,r,t,i,d=m(this).jqGrid("getNodeChildren",l,this.p.search),a=m.jgrid.from.call(this,d);for(a.orderBy(n,p,o,h),e=0,r=(i=a.select()).length;e<r;e++)t=i[e],s.push(t),m(this).jqGrid("collectChildrenSortTree",s,t,n,p,o,h)}})},setTreeRow:function(e,r){var t=!1;return this.each(function(){this.grid&&this.p.treeGrid&&(t=m(this).jqGrid("setRowData",e,r))}),t},delTreeNode:function(h){return this.each(function(){var e,r,t,i,d,a=this,s=a.p.localReader.id,l=a.p.treeReader.left_field,n=a.p.treeReader.right_field;if(a.grid&&a.p.treeGrid){h=m.jgrid.stripPref(a.p.idPrefix,h);var p=a.p._index[h];if(void 0!==p){t=(r=parseInt(a.p.data[p][n],10))-parseInt(a.p.data[p][l],10)+1;var o=m(a).jqGrid("getFullTreeNode",a.p.data[p]);if(0<o.length)for(e=0;e<o.length;e++)m(a).jqGrid("delRowData",a.p.idPrefix+o[e][s]);if("nested"===a.p.treeGridModel){if((i=m.jgrid.from.call(a,a.p.data).greater(l,r,{stype:"integer"}).select()).length)for(d in i)i.hasOwnProperty(d)&&(i[d][l]=parseInt(i[d][l],10)-t);if((i=m.jgrid.from.call(a,a.p.data).greater(n,r,{stype:"integer"}).select()).length)for(d in i)i.hasOwnProperty(d)&&(i[d][n]=parseInt(i[d][n],10)-t)}}}})},delChildren:function(h){return this.each(function(){var e,r,t,i,d=this,a=d.p.localReader.id,s=d.p.treeReader.left_field,l=d.p.treeReader.right_field;if(d.grid&&d.p.treeGrid){h=m.jgrid.stripPref(d.p.idPrefix,h);var n=d.p._index[h];if(void 0!==n){r=(e=parseInt(d.p.data[n][l],10))-parseInt(d.p.data[n][s],10)+1;var p=m(d).jqGrid("getFullTreeNode",d.p.data[n]);if(0<p.length)for(var o=0;o<p.length;o++)p[o][a]!==h&&m(d).jqGrid("delRowData",d.p.idPrefix+p[o][a]);if("nested"===d.p.treeGridModel){if((t=m.jgrid.from(d.p.data).greater(s,e,{stype:"integer"}).select()).length)for(i in t)t.hasOwnProperty(i)&&(t[i][s]=parseInt(t[i][s],10)-r);if((t=m.jgrid.from(d.p.data).greater(l,e,{stype:"integer"}).select()).length)for(i in t)t.hasOwnProperty(i)&&(t[i][l]=parseInt(t[i][l],10)-r)}}}})},addChildNode:function(e,r,t,i){var d=this[0];if(t){var a,s,l,n,p=d.p.treeReader.expanded_field,o=d.p.treeReader.leaf_field,h=d.p.treeReader.level_field,f=d.p.treeReader.parent_id_field,c=d.p.treeReader.left_field,g=d.p.treeReader.right_field,u=d.p.treeReader.loaded,G=0,v=r;if(void 0===i&&(i=!1),null==e){if(0<=(y=d.p.data.length-1))for(;0<=y;)G=Math.max(G,parseInt(d.p.data[y][d.p.localReader.id],10)),y--;e=G+1}var _,j,R=m(d).jqGrid("getInd",r),I=!1;if(null==r||""===r)v=r=null,a="last",s=d.p.tree_root_level,y=d.p.data.length+1;else{a="after";var w,x=m.jgrid.stripPref(d.p.idPrefix,r),q=d.p._index[x];r=(w=d.p.data[q])[d.p.localReader.id],s=parseInt(w[h],10)+1;var N=m(d).jqGrid("getFullTreeNode",w),y=N.length?(v=y=N[N.length-1][d.p.localReader.id],m(d).jqGrid("getInd",d.p.idPrefix+v)):m(d).jqGrid("getInd",d.p.idPrefix+r);if(w[o]&&(I=!0,w[p]=!0,m(d.rows[R]).find("span.cell-wrapperleaf").removeClass("cell-wrapperleaf").addClass("cell-wrapper").end().find("div.tree-leaf").removeClass(d.p.treeIcons.leaf+" tree-leaf").addClass(d.p.treeIcons.minus+" tree-minus"),d.p.data[q][o]=!1,w[u]=!0),!1===y)throw"Parent item with id: "+v+" ("+r+") can't be found";y++}if(l=y+1,void 0===t[p]&&(t[p]=!1),void 0===t[u]&&(t[u]=!1),t[h]=s,void 0===t[o]&&(t[o]=!0),"adjacency"===d.p.treeGridModel&&(t[f]=r),"nested"===d.p.treeGridModel)if(null!==r){if(n=parseInt(w[g],10),(_=m.jgrid.from.call(d,d.p.data).greaterOrEquals(g,n,{stype:"integer"}).select()).length)for(j in _)_.hasOwnProperty(j)&&(_[j][c]=_[j][c]>n?parseInt(_[j][c],10)+2:_[j][c],_[j][g]=_[j][g]>=n?parseInt(_[j][g],10)+2:_[j][g]);t[c]=n,t[g]=n+1}else{if(n=parseInt(m(d).jqGrid("getCol",g,!1,"max"),10),(_=m.jgrid.from.call(d,d.p.data).greater(c,n,{stype:"integer"}).select()).length)for(j in _)_.hasOwnProperty(j)&&(_[j][c]=parseInt(_[j][c],10)+2);if((_=m.jgrid.from.call(d,d.p.data).greater(g,n,{stype:"integer"}).select()).length)for(j in _)_.hasOwnProperty(j)&&(_[j][g]=parseInt(_[j][g],10)+2);t[c]=n+1,t[g]=n+2}(null===r||m(d).jqGrid("isNodeLoaded",w)||I)&&(m(d).jqGrid("addRowData",e,t,a,d.p.idPrefix+v),m(d).jqGrid("setTreeNode",y,l)),w&&!w[p]&&i&&m(d.rows[R]).find("div.treeclick").click()}}})});