<script type="text/javascript">

    $(document).ready(function () {
        $('#tblRemovedLocation').bootstrapTable();
    });

    $(document).ready(function () {
        $('#tblLocation').bootstrapTable();
    });

    $(document).ready(function () {
        $('#tblRemovedProject').bootstrapTable();
    });

    $(document).ready(function () {
        $('#tblProject').bootstrapTable();
    });

    function Cancel(Form, Tab) {
        document.getElementById(Form).reset();
        SetCurrentTab(Tab);
    }

    function CreateEditLabel(ObjectLabel) {
        var div = document.createElement("div");
        div.setAttribute("class", "form-group");
        var label = document.createElement("label");
        label.innerHTML = "Select a " + ObjectLabel + " from the 'List All' Tab and Click Edit Button";
        div.appendChild(label);
        return div;
    }

    function ResetFormView(Form, AddTabId, EditTabId, Object, AddButtonId, CancelButtonId,) {
        var editTabHTML = document.getElementById(EditTabId);
        if (editTabHTML.children.length != 1) {
            document.getElementById(Form).reset();
            var addTabHTML = document.getElementById(AddTabId);
            addTabHTML.innerHTML = editTabHTML.innerHTML;
            addTabHTML.editTabHTML = "";
            editTabHTML.appendChild(CreateEditLabel(Object));
            document.getElementById(AddButtonId).innerText = "Add";
            document.getElementById(CancelButtonId).innerText = "Clear and Cancel";
        }
    }

    function CloneFormView(AddTabId, EditTabId, AddButtonId, CancelButtonId) {
        var editTabHTML = document.getElementById(EditTabId);
        var addTabHTML = document.getElementById(AddTabId);  
        editTabHTML.innerHTML = addTabHTML.innerHTML;
        addTabHTML.innerHTML = "";
        document.getElementById(AddButtonId).innerText = "Update";
        document.getElementById(CancelButtonId).innerText = "Cancel Update";
    }

    function AddLocation() {
        var form = document.getElementById("LocationViewModel");
        var formValid = TableFormValidation(form , "location");
        if (formValid) {
            sessionStorage.setItem('accordianTrigger', 'Location');
            $.ajax({
                url: '@Url.Action("AddLocation", "Services")',
                type: "POST",
                data: $("#tab_1 :input").serialize({ json: true })
            })
                .done(function () {
                    //Save the session and reload
                    form.reset();
                    location.reload();
                })
                .fail(function (a, s, d) {
                    debugger;
                });
        }
    }

    function RemoveLocation(Id) {
        sessionStorage.setItem('accordianTrigger', 'Location');
        var postData = { LocationId: Id };
        $.ajax({
            url: '@Url.Action("RemoveLocation", "Services")',
            type: "POST",
            data: postData
        })
            .done(function () {
                //Save the session and reload                
                location.reload();
            })
            .fail(function (a, s, d) {
                debugger;
            });
    }

    function RestoreLocation(Id) {
        sessionStorage.setItem('accordianTrigger', 'Location');
        var postData = { LocationId: Id };
        $.ajax({
            url: '@Url.Action("RestoreLocation", "Services")',
            type: "POST",
            data: postData
        })
            .done(function () {
                //Save the session and reload                
                location.reload();
            })
            .fail(function (a, s, d) {
                debugger;
            });
    }

    function EditLocation(Id, LocationType, CommonName, Street, City, Country, Suburb, Postcode) {
        CloneFormView("locationtab3", "locationtab2", "LocationAddButton", "LocationCancelButton");

        document.getElementById("LocationId").value = Id;
        document.getElementById("locationtypeoptions").value = LocationType;
        document.getElementById("commonnamedetails").value = CommonName;
        document.getElementById("streetdetails").value = Street;
        document.getElementById("citydetails").value = City;
        document.getElementById("countrydetails").value = Country;
        document.getElementById("suburbdetails").value = Suburb;
        document.getElementById("postcodedetails").value = Postcode;        

        SetCurrentTab("locationtab2");
    }

    function AddProject() {
        var form = document.getElementById("ProjectViewModel");
        var formValid = TableFormValidation(form, "project");
        if (formValid) {
            sessionStorage.setItem('accordianTrigger', 'Projects');
            $.ajax({
                url: '@Url.Action("AddProject", "Services")',
                type: "POST",
                data: $("#tab_1 :input").serialize({ json: true }),
                async: false
            })
                .done(function () {
                    //Save the session and reload 
                    form.reset();
                    location.reload();
                })
                .fail(function (a, s, d) {
                    debugger;
                });
        }
    }

    function RemoveProject(Id) {
        sessionStorage.setItem('accordianTrigger', 'Projects');
        var postData = { ProjectId: Id };
        $.ajax({
            url: '@Url.Action("RemoveProject", "Services")',
            type: "POST",
            data: postData
        })
            .done(function () {
                //Save the session and reload                
                location.reload();
            })
            .fail(function (a, s, d) {
                debugger;
            });
    }

    function RestoreProject(Id) {
        sessionStorage.setItem('accordianTrigger', 'Projects');
        var postData = { ProjectId: Id };
        $.ajax({
            url: '@Url.Action("RestoreProject", "Services")',
            type: "POST",
            data: postData
        })
            .done(function () {
                //Save the session and reload                
                location.reload();
            })
            .fail(function (a, s, d) {
                debugger;
            });
    }

    function EditProject(Id, ProjectDescription, Fees, ConstructionValue, ProjectDuration, ProjectResponsibilityData) {
        event.preventDefault();
        CloneFormView("projecttab3", "projecttab2", "ProjectAddButton", "ProjectCancelButton");

        document.getElementById("ProjectId").value = Id;
        document.getElementById("projectdetails").value = ProjectDescription;
        document.getElementById("projectfees").value = Fees;
        document.getElementById("contractdetails").value = ConstructionValue;
        document.getElementById("durationdetails").value = ProjectDuration;

        var array = ProjectResponsibilityData.split(',');
        for (var i = 0; i < array.length; i++) {
            var cb = document.getElementById("responsibility."+i);
            if (array[i] == "True") {
                cb.setAttribute("checked","true");
            }
        }

        SetCurrentTab("projecttab2");
    }

    function TableFormValidation(Form, SectionName) {
        for (var e = 0; e < Form.length; e++) {
            var element = null;
            try {
                if (Form[e].id != "") {
                    element = document.getElementById(Form[e].id);
                }
            }
            catch (ex) {
                //will have to add further function for forms with added elements
            }
            if (element != null) {
                OnChange(element.id, element.name);
                if ((element.classList.contains("is-invalid") || element.classList.contains("is-up")) && element.hidden == false) {
                    event.preventDefault();
                    event.stopPropagation();
                    window.alert("Please complete "+SectionName+" details");
                    return false;
                }
            }            
        }
        return true;
    }

</script>