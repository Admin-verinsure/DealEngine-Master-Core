<script type="text/javascript">   
    //intialize objects on load
           var d = new Date();
           var currMonth = d.getMonth();
           var currYear = d.getFullYear();
           var currDate = d.getDate();

           if (currMonth < 8) {
                 currMonth = 8;
                 var startDate = new Date(currYear, currMonth, 1);
           } else {
                 var startDate = new Date(currYear, currMonth, currDate);
            }
    
    $('#FAPCoverStartDate').datepicker({
           dateFormat: "dd/mm/yy",
            minDate: startDate
    });

    function PopulateOrganisationView(Method, OutPut) {
        var Form;
        Form = document.getElementById("organisationViewModel");        
        try {
            var TradingName = document.getElementById("NoTradingName");
            if (TradingName != null) {
                TradingName.value = false;
            }             
            for (obj in OutPut) {
                var model = OutPut[obj];
                if (obj == "0") {
                    Type = "User";
                }
                else {
                    Type = "Organisation";
                }
                for (var Field in model) {
                    var Element = null;
                    var Value = "";

                    if (model.hasOwnProperty("InsuranceAttributes")) {
                        if (Field === "InsuranceAttributes") {
                            if (OutPut[obj][Field]["0"]["Name"] === "Principal") {
                                debugger;
                                PopulateOrganisationalUnit(OutPut, "PrincipalUnit");
                                var Id = Type + ".InsuranceAttribute";
                                Element = document.getElementById(Id);
                                Value = "Principal";
                            }
                            else if (OutPut[obj][Field]["0"]["Name"] === "Advisor" ) {
                                PopulateOrganisationalUnit(OutPut, "AdvisorUnit");
                                var Id = Type + ".InsuranceAttribute";
                                Element = document.getElementById(Id);
                                Value = "Advisor";
                            }else if (OutPut[obj][Field]["0"]["Name"] === "Administration" ) {
                                PopulateOrganisationalUnit(OutPut, "AdvisorUnit");
                                var Id = Type + ".InsuranceAttribute";
                                Element = document.getElementById(Id);
                                Value = "Administration";
                            }
                            else if (OutPut[obj][Field]["0"]["Name"] === "Personnel") {
                                PopulateOrganisationalUnit(OutPut, "PersonnelUnit");
                                var Id = Type + ".InsuranceAttribute";
                                Element = document.getElementById(Id);
                                Value = "Personnel";
                            }
                            //}
                            //else if (OutPut[obj][Field]["0"]["Name"] != "") {
                            //    Value = OutPut[obj][Field]["0"]["Name"];
                            //    var Id = Type + ".InsuranceAttribute";
                            //    Element = document.getElementById(Id);
                            //}
                        }
                    }

                    if (Element == null) {
                        var Id = Type + "." + Field;
                        Element = document.getElementById(Id);
                        Value = OutPut[obj][Field];
                    }
                    if (Element != null) {
                        
                        //ImportValue(element, Value);
                        if (Element.tagName == "INPUT") {
                            if (Element.type == "date") {
                                //hardcord date string
                                var date = Value.substring(0, 10);
                                Element.value = date;
                            }
                            else {
                                Element.value = Value;
                            }
                        }
                        else if (Element.tagName == "SELECT") {
                            //debugger;
                            for (var o = 0; o < Element.options.length; o++) {
                                if (Element.options[o].value == Value.toString()) {
                                    Element.options[o].selected = true;
                                    break;
                                }
                            }
                        }
                        OnChange(Element.id, Element.name);
                    }
                    else { console.log(Id) }
                }
                if (Method == "Owner") {
                    var TradingName = document.getElementById("NoTradingName");
                    if (TradingName != null) {
                        TradingName.value = true;
                    }
                    document.getElementById("Organisation.OrganisationType").disabled = true;
                    var IA = document.getElementById("Organisation.InsuranceAttribute");
                    IA.options[IA.selectedIndex].value = "Person - Individual";
                    IA.options[IA.selectedIndex].text = "Person - Individual";
                    IA.disabled = true;
                    document.getElementById("Else").hidden = false;
                }
            }
        } catch (ex) { debugger; }
    }

    function PopulateOrganisationalUnit(OutPut, UnitName) {
        for (var ArrayNo in OutPut["1"]["OrganisationalUnits"]) {
            for (var Item in OutPut["1"]["OrganisationalUnits"][ArrayNo]) {
                id = UnitName + "." + Item;
                var element = document.getElementById(id);
                if (element != null) {
                    var Value = OutPut["1"]["OrganisationalUnits"][ArrayNo][Item];
                    if (element.tagName == "INPUT") {
                        if (element.type == "date") {
                            //hardcord date string
                            var date = Value.substring(0, 10);
                            element.value = date;
                        }
                        else {
                            element.value = Value;
                        }
                    }
                    else if (element.tagName == "SELECT") {
                        if (Value == "1") {
                            Value = "true"
                        }
                        else if (Value == "2") {
                            Value = "false";
                        }
                        for (var o = 0; o < element.options.length; o++) {
                            if (element.options[o].value == Value.toString()) {
                                element.options[o].selected = true;
                                break;
                            }
                        }
                    }
                    OnChange(element.id, element.name);
                }
            }
        }
    }

</script>