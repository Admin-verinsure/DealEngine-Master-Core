@model IEnumerable<techcertain2015rebuildcore.Models.ViewModels.UserViewModel>

<!-- MAIN CONTENT -->
<div id="content">
    <div class="row">
		
    	<!-- NEW WIDGET START -->
        <article class="col-xs-12 col-sm-12 col-md-6 col-lg-6">

            <!-- Widget ID (each widget will need unique ID)-->
            <div class="jarviswidget jarviswidget-color-darken" id="wid-id-0" data-widget-editbutton="false">
                <header>
                    <span class="widget-icon"> <i class="fa fa-table"></i> </span>
                    <h2>Manage Roles </h2>

                </header>

                <!-- widget div-->
                <div>
                    <!-- widget edit box -->
                    <div class="jarviswidget-editbox">
                        <!-- This area used as dropdown edit box -->
                    </div>
                    <!-- end widget edit box -->
                    <!-- widget content -->
                    <div class="widget-body no-padding">
                        <table id="tableUsers" class="table table-striped table-bordered table-hover" width="100%">
                            <thead>
                                <tr>
							        <th>
							            @Html.DisplayNameFor(model => model.UserName)
							        </th>
							        <th>
							            @Html.DisplayNameFor(model => model.FirstName)
							        </th>
							        <th>
							            @Html.DisplayNameFor(model => model.LastName)
							        </th>
							        <th>
							            @Html.DisplayNameFor(model => model.Email)
									</th>
									<th></th>
								</tr>
							</thead>
							<tbody>
							@foreach (var item in Model) {
								<tr>
							        <td>
							            @Html.DisplayFor(modelItem => item.UserName)
							        </td>
							        <td>
							            @Html.DisplayFor(modelItem => item.FirstName)
							        </td>
							        <td>
							            @Html.DisplayFor(modelItem => item.LastName)
							        </td>
							        <td>
							            @Html.DisplayFor(modelItem => item.Email)
							        </td>
							        <td>
							            @Html.ActionLink("Edit", "ManageUser", new { id = item.ID }) |
							            @Html.ActionLink("Groups", "ManageUser", new { id = item.ID }) |
										<a href="javascript:void(0);" onclick="ShowEffectivePermissionsModal('@item.ID');">Effective Permissions</a> ||| 
										<a href="javascript:void(0);" onclick="DeleteUser('@item.ID');">Delete</a>
									</td>
								</tr>
							}
							</tbody>
							<tfoot>
								<tr>
									<td colspan="5"><a href="javascript:void(0);" onclick = "ShowCreateModal();">Add New User</a></td>
								</tr>
							</tfoot>
						</table>
					</div>
				</div>
			</div>
		</article>

    	@using (var modal = Html.Bootstrap().Begin(new Modal().Id("viewPermissions").Closeable()))
		{
		    @modal.Header("View Effective Permissions")
		    <div class="modal-body" id="viewPermissionsModalBody">
            </div>
		}
	</div>
</div>
<!-- END MAIN CONTENT -->

@section pagespecific {
<!-- PAGE RELATED PLUGIN(S) -->
<link href="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/css/bootstrap-editable.css" rel="stylesheet"/>
<script src="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/js/bootstrap-editable.min.js"></script>
<script src="/Scripts/datatables"></script>

<script type="text/javascript">
$(document).ready(function () {
	$('#tableUsers').DataTable({
		"sDom": "<'dt-toolbar'<'col-xs-12 col-sm-6'f><'col-sm-6 col-xs-12 hidden-xs'l>r>" +
                "t" +
                "<'dt-toolbar-footer'<'col-sm-6 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-6'p>>",
            	"autoWidth": true
	});
});

function ShowEffectivePermissionsModal(userId)
{
	$('#viewPermissions').modal('show');
	$('#viewPermissionsModalBody').html('<p><img src="/Content/img/loading.gif"/> Loading Permissions. Please wait...</p>');
	$('#viewPermissionsModalBody').load("UserPermissions/" + userId);
}

function DeleteUser(userId)
{
	if (confirm("Are you sure you want to delete this user?") == false)
		return;

	alert("Not implemented yet");
}

function ShowCreateModal()
{

}
</script>
}
